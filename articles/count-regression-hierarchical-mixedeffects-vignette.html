<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Heirarchical / Mixed Effects • appregr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Heirarchical / Mixed Effects">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">appregr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/count-regression-bayesian-vignette.html">Count Regression Part II - Bayesian Approches</a>
    </li>
    <li>
      <a href="../articles/count-regression-hierarchical-mixedeffect-partII-vignettes.html">Count Regression Part III - Heirarchical / Mixed Effects</a>
    </li>
    <li>
      <a href="../articles/count-regression-hierarchical-mixedeffects-vignette.html"> Heirarchical / Mixed Effects</a>
    </li>
    <li>
      <a href="../articles/count-regression-vignette.html">Count Regression</a>
    </li>
    <li>
      <a href="../articles/regression-diagnositcs-vignette.html">regression-diagnostics-vignette</a>
    </li>
    <li>
      <a href="../articles/regression-numerical-linalg-vignette.html">regression-numerical-linalg-vignette</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Heirarchical / Mixed Effects</h1>
            <h3 class="subtitle">Tutorial</h3>
                        <h4 class="author">Bruce Campbell</h4>
            
            <h4 class="date">25 July, 2019</h4>
      
      
      <div class="hidden name"><code>count-regression-hierarchical-mixedeffects-vignette.Rmd</code></div>

    </div>

    
    
<div id="linear-mixed-effects" class="section level1">
<h1 class="hasAnchor">
<a href="#linear-mixed-effects" class="anchor"></a>Linear Mixed Effects</h1>
<p>Mixed-effects or mixed models have covariates with both fixed and random effects. The values for at least one set of effects (intercepts and/or slopes) to come from a normal distribution.This is what the random-effects assumption means. A close examination of how such a dataset can be simulated will help us better understand how real datasets are estimated down using mixed models. Very few strategies can be more effective to understand this type of mixed model than the combination of simulating data sets and describing the models fitted.</p>
<div id="model-types" class="section level3">
<h3 class="hasAnchor">
<a href="#model-types" class="anchor"></a>Model Types</h3>
<ul>
<li>random intercepts only</li>
<li>independent random intercepts and slopes</li>
<li>correlated random intercepts and slopes</li>
<li>modeling 2 correlated random effects with a scaled Inverse Wishart instead</li>
<li>general correlated random effects with a scaled Inverse Wishart</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">n_subjects &lt;-<span class="st"> </span><span class="dv">56</span>  <span class="co"># Number of subjects</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">n_sample &lt;-<span class="st"> </span><span class="dv">10</span>  <span class="co"># Number of observations for each subject</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">n_obs &lt;-<span class="st"> </span>n_subjects <span class="op">*</span><span class="st"> </span>n_sample  <span class="co"># Total number of data points</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">subjects &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gl">gl</a></span>(<span class="dt">n =</span> n_subjects, <span class="dt">k =</span> n_sample)  <span class="co"># Indicator for subjects</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co"># Continuous predictor x</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">original_x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(n_obs, <span class="dv">45</span>, <span class="dv">70</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co"># standardize it</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">mean_orig_x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(original_x)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">sd_orig_x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/sd">sd</a></span>(original_x)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">x &lt;-<span class="st"> </span>(original_x <span class="op">-</span><span class="st"> </span>mean_orig_x)<span class="op">/</span>sd_orig_x</a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(x)</a></code></pre></div>
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
-1.691459 -0.901603 -0.008436  0.000000  0.886670  1.713497 </code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(x, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(x), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># This is the model matrix for the means parametrization of the interaction</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co"># model between the subjects and the continuous covariate x</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">Xmat &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/model.matrix">model.matrix</a></span>(<span class="op">~</span>subjects <span class="op">*</span><span class="st"> </span>x <span class="op">-</span><span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x)</a></code></pre></div>
<p>Parameters for the distributions of the random coefficients / random effects (note that the intercepts and slopes comes from two independent Gaussian distributions)</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">intercept_mean &lt;-<span class="st"> </span><span class="dv">230</span>  <span class="co"># mu_alpha</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">intercept_sd &lt;-<span class="st"> </span><span class="dv">20</span>  <span class="co"># sigma_alpha</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">slope_mean &lt;-<span class="st"> </span><span class="dv">60</span>  <span class="co"># mu_beta</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">slope_sd &lt;-<span class="st"> </span><span class="dv">30</span>  <span class="co"># sigma_beta</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co"># Generate the random coefficients:</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"></a>
<a class="sourceLine" id="cb5-9" data-line-number="9">intercept_effects &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dt">n =</span> n_subjects, <span class="dt">mean =</span> intercept_mean, <span class="dt">sd =</span> intercept_sd)</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">slope_effects &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dt">n =</span> n_subjects, <span class="dt">mean =</span> slope_mean, <span class="dt">sd =</span> slope_sd)</a>
<a class="sourceLine" id="cb5-11" data-line-number="11"></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(intercept_effects, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">10</span>, </a>
<a class="sourceLine" id="cb5-14" data-line-number="14">    <span class="dt">freq =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(intercept_effects), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(slope_effects, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">10</span>, </a>
<a class="sourceLine" id="cb5-17" data-line-number="17">    <span class="dt">freq =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(slope_effects), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">all_effects &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(intercept_effects, slope_effects)  <span class="co"># Put them all together</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co"># Generating the continuous response variable:</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">lin_pred &lt;-<span class="st"> </span>Xmat <span class="op">%*%</span><span class="st"> </span>all_effects  <span class="co"># Value of lin_predictor</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(lin_pred)</a></code></pre></div>
<pre><code> num [1:560, 1] 269 264 242 257 215 ...
 - attr(*, "dimnames")=List of 2
  ..$ : chr [1:560] "1" "2" "3" "4" ...
  ..$ : NULL</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># -- the stochastic part</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">sigma_res &lt;-<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">normal_error &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dt">n =</span> n_obs, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> sigma_res)  <span class="co"># residuals</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">y &lt;-<span class="st"> </span>lin_pred <span class="op">+</span><span class="st"> </span>normal_error</a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co"># alternatively y &lt;- rnorm(n = n_obs, mean = lin_pred, sd = sigma_res)</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co"># We take a look at the response variable</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(y, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">30</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(y), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-2-2.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(y)</a></code></pre></div>
<pre><code>       V1        
 Min.   : 24.17  
 1st Qu.:178.83  
 Median :227.98  
 Mean   :230.09  
 3rd Qu.:282.03  
 Max.   :451.27  </code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"lattice"</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/lattice/topics/xyplot">xyplot</a></span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">|</span><span class="st"> </span>subjects)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-2-3.png" width="700"></p>
</div>
<div id="reml-analysis-using-r-lme4" class="section level3">
<h3 class="hasAnchor">
<a href="#reml-analysis-using-r-lme4" class="anchor"></a>REML analysis using R lme4</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"lme4"</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">lme_fit1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/lme4/topics/lmer">lmer</a></span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>subjects))</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(lme_fit1, <span class="dt">cor =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: y ~ x + (1 | subjects)
REML criterion at convergence: 5836.374
Random effects:
 Groups   Name        Std.Dev.
 subjects (Intercept) 21.95   
 Residual             41.86   
Number of obs: 560, groups:  subjects, 56
Fixed Effects:
(Intercept)            x  
      230.1         59.3  </code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/lme4/topics/fixef">fixef</a></span>(lme_fit1)</a></code></pre></div>
<pre><code>(Intercept)           x 
  230.08675    59.30436 </code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/lme4/topics/ranef">ranef</a></span>(lme_fit1), <span class="dt">main =</span> <span class="st">"fitted random effects"</span>)</a></code></pre></div>
<pre><code>$subjects</code></pre>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">coef.re &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(lme_fit1)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(coef.re[[<span class="dv">1</span>]][, <span class="dv">1</span>], coef.re[[<span class="dv">1</span>]][, <span class="dv">2</span>], <span class="dt">main =</span> <span class="st">"Coefficients "</span>, <span class="dt">ylab =</span> <span class="st">"(Intercept)"</span>, </a>
<a class="sourceLine" id="cb18-3" data-line-number="3">    <span class="dt">xlab =</span> <span class="st">"x"</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># Compare with true values:</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">intercept_mean =</span> intercept_mean, <span class="dt">slope_mean =</span> slope_mean, <span class="dt">intercept_sd =</span> intercept_sd, </a>
<a class="sourceLine" id="cb19-3" data-line-number="3">    <span class="dt">slope_sd =</span> slope_sd, <span class="dt">sigma_res =</span> sigma_res)</a></code></pre></div>
<pre><code>  intercept_mean slope_mean intercept_sd slope_sd sigma_res
1            230         60           20       30        30</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(lme_fit1, <span class="dt">cor =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: y ~ x + (1 | subjects)
REML criterion at convergence: 5836.374
Random effects:
 Groups   Name        Std.Dev.
 subjects (Intercept) 21.95   
 Residual             41.86   
Number of obs: 560, groups:  subjects, 56
Fixed Effects:
(Intercept)            x  
      230.1         59.3  </code></pre>
</div>
<div id="bayesian-hierarchical-analysis-using-jags" class="section level2">
<h2 class="hasAnchor">
<a href="#bayesian-hierarchical-analysis-using-jags" class="anchor"></a>Bayesian hierarchical analysis using JAGS</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co"># Write model</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"model {</span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="st"># Priors</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="st">mu_int~dnorm(0, 0.0001) # Mean hyperparameter for random intercepts</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="st">sigma_int~dunif(0, 100) # SD hyperparameter for random intercepts</span></a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="st">tau_int &lt;- 1/(sigma_int*sigma_int)</span></a>
<a class="sourceLine" id="cb23-7" data-line-number="7"><span class="st">for (i in 1:n_subj) {</span></a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="st">    alpha[i]~dnorm(mu_int, tau_int) # Random intercepts</span></a>
<a class="sourceLine" id="cb23-9" data-line-number="9"><span class="st">}</span></a>
<a class="sourceLine" id="cb23-10" data-line-number="10"><span class="st">beta~dnorm(0, 0.0001) # Common slope</span></a>
<a class="sourceLine" id="cb23-11" data-line-number="11"><span class="st">sigma_res~dunif(0, 100) # Residual standard deviation</span></a>
<a class="sourceLine" id="cb23-12" data-line-number="12"><span class="st">tau_res &lt;- 1/(sigma_res*sigma_res)</span></a>
<a class="sourceLine" id="cb23-13" data-line-number="13"><span class="st"># Likelihood</span></a>
<a class="sourceLine" id="cb23-14" data-line-number="14"><span class="st">for (i in 1:n_obs) {</span></a>
<a class="sourceLine" id="cb23-15" data-line-number="15"><span class="st">    mu[i] &lt;- alpha[subjects[i]]+beta*x[i] # Expectation</span></a>
<a class="sourceLine" id="cb23-16" data-line-number="16"><span class="st">    y[i]~dnorm(mu[i], tau_res) # The actual (random) responses</span></a>
<a class="sourceLine" id="cb23-17" data-line-number="17"><span class="st">}</span></a>
<a class="sourceLine" id="cb23-18" data-line-number="18"><span class="st">}"</span>, </a>
<a class="sourceLine" id="cb23-19" data-line-number="19">    <span class="dt">fill =</span> <span class="ot">TRUE</span>, <span class="dt">file =</span> <span class="st">"lme_model1.txt"</span>)</a>
<a class="sourceLine" id="cb23-20" data-line-number="20"></a>
<a class="sourceLine" id="cb23-21" data-line-number="21"></a>
<a class="sourceLine" id="cb23-22" data-line-number="22">jags_data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">y =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(y), <span class="dt">subjects =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(subjects), <span class="dt">x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(x), </a>
<a class="sourceLine" id="cb23-23" data-line-number="23">    <span class="dt">n_subj =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(subjects)), <span class="dt">n_obs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(n_obs))</a>
<a class="sourceLine" id="cb23-24" data-line-number="24"><span class="co"># use as.numeric across the board for the data passed to JAGS; it might work</span></a>
<a class="sourceLine" id="cb23-25" data-line-number="25"><span class="co"># w/o it, but this is often needed for other BUGS packages</span></a>
<a class="sourceLine" id="cb23-26" data-line-number="26"></a>
<a class="sourceLine" id="cb23-27" data-line-number="27"><span class="co"># Inits function</span></a>
<a class="sourceLine" id="cb23-28" data-line-number="28">inits &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb23-29" data-line-number="29">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">alpha =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(n_subjects, <span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">beta =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">mu_int =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">1</span>, </a>
<a class="sourceLine" id="cb23-30" data-line-number="30">        <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">sigma_int =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">1</span>), <span class="dt">sigma_res =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb23-31" data-line-number="31">}</a>
<a class="sourceLine" id="cb23-32" data-line-number="32"></a>
<a class="sourceLine" id="cb23-33" data-line-number="33"><span class="co"># Parameters to estimate</span></a>
<a class="sourceLine" id="cb23-34" data-line-number="34">params &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"mu_int"</span>, <span class="st">"sigma_int"</span>, <span class="st">"sigma_res"</span>)</a>
<a class="sourceLine" id="cb23-35" data-line-number="35"></a>
<a class="sourceLine" id="cb23-36" data-line-number="36"><span class="co"># MCMC settings</span></a>
<a class="sourceLine" id="cb23-37" data-line-number="37">ni &lt;-<span class="st"> </span><span class="dv">11000</span></a>
<a class="sourceLine" id="cb23-38" data-line-number="38">nb &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb23-39" data-line-number="39">nt &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb23-40" data-line-number="40">nc &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb23-41" data-line-number="41"></a>
<a class="sourceLine" id="cb23-42" data-line-number="42"><span class="co"># Start Gibbs sampling</span></a>
<a class="sourceLine" id="cb23-43" data-line-number="43"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"R2jags"</span>)</a>
<a class="sourceLine" id="cb23-44" data-line-number="44">outj &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/R2jags/topics/jags">jags</a></span>(jags_data, <span class="dt">inits =</span> inits, <span class="dt">parameters.to.save =</span> params, <span class="dt">model.file =</span> <span class="st">"lme_model1.txt"</span>, </a>
<a class="sourceLine" id="cb23-45" data-line-number="45">    <span class="dt">n.thin =</span> nt, <span class="dt">n.chains =</span> nc, <span class="dt">n.burnin =</span> nb, <span class="dt">n.iter =</span> ni)</a></code></pre></div>
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 560
   Unobserved stochastic nodes: 60
   Total graph size: 2870

Initializing model</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">out &lt;-<span class="st"> </span>outj<span class="op">$</span>BUGSoutput</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="co"># Compare with MLEs and true values</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">intercept_mean =</span> intercept_mean, <span class="dt">slope_mean =</span> slope_mean, <span class="dt">intercept_sd =</span> intercept_sd, </a>
<a class="sourceLine" id="cb25-5" data-line-number="5">    <span class="dt">slope_sd =</span> slope_sd, <span class="dt">sigma_res =</span> sigma_res)</a></code></pre></div>
<pre><code>  intercept_mean slope_mean intercept_sd slope_sd sigma_res
1            230         60           20       30        30</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>mean, <span class="dt">dig =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>$alpha
 [1] 232.0 240.1 215.1 258.1 202.0 235.5 238.0 250.5 196.3 247.0 234.5
[12] 244.0 237.9 171.0 208.8 236.1 233.5 233.2 239.0 271.2 237.9 223.2
[23] 242.7 213.6 228.6 222.3 245.7 223.8 228.1 207.8 230.3 231.9 232.3
[34] 230.3 242.6 225.8 258.9 197.1 200.2 239.7 244.0 223.9 237.6 225.1
[45] 235.8 244.2 184.9 252.4 240.2 247.5 211.9 262.0 225.4 222.6 222.8
[56] 211.8

$beta
[1] 59.28

$deviance
[1] 5773

$mu_int
[1] 229.6

$sigma_int
[1] 22.57

$sigma_res
[1] 41.99</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(lme_fit1, <span class="dt">cor =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: y ~ x + (1 | subjects)
REML criterion at convergence: 5836.374
Random effects:
 Groups   Name        Std.Dev.
 subjects (Intercept) 21.95   
 Residual             41.86   
Number of obs: 560, groups:  subjects, 56
Fixed Effects:
(Intercept)            x  
      230.1         59.3  </code></pre>
<p>The same model can be parametrized by making the mean of the intercept ranefs a fixed effect and modeling the subject ranefs as coming from a normal distribution centered at 0. This is in fact how the lmer function models ranefs.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"model {</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="st"># Priors</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="st">sigma_int~dunif(0, 100) # SD hyperparameter for random intercepts</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="st">tau_int &lt;- 1/(sigma_int*sigma_int)</span></a>
<a class="sourceLine" id="cb31-5" data-line-number="5"><span class="st">for (i in 1:n_subj) {</span></a>
<a class="sourceLine" id="cb31-6" data-line-number="6"><span class="st">    alpha[i]~dnorm(0, tau_int) # Random by-subject deflections to the intercept</span></a>
<a class="sourceLine" id="cb31-7" data-line-number="7"><span class="st">}</span></a>
<a class="sourceLine" id="cb31-8" data-line-number="8"><span class="st">mu_int~dnorm(0, 0.0001) # The mean intercept</span></a>
<a class="sourceLine" id="cb31-9" data-line-number="9"><span class="st">beta~dnorm(0, 0.0001) # Common slope</span></a>
<a class="sourceLine" id="cb31-10" data-line-number="10"><span class="st">sigma_res~dunif(0, 100) # Residual standard deviation</span></a>
<a class="sourceLine" id="cb31-11" data-line-number="11"><span class="st">tau_res &lt;- 1/(sigma_res*sigma_res)</span></a>
<a class="sourceLine" id="cb31-12" data-line-number="12"><span class="st"># Likelihood</span></a>
<a class="sourceLine" id="cb31-13" data-line-number="13"><span class="st">for (i in 1:n_obs) {</span></a>
<a class="sourceLine" id="cb31-14" data-line-number="14"><span class="st">    mu[i] &lt;- mu_int + alpha[subjects[i]] + beta*x[i] # Expectation</span></a>
<a class="sourceLine" id="cb31-15" data-line-number="15"><span class="st">    y[i]~dnorm(mu[i], tau_res) # The actual (random) responses</span></a>
<a class="sourceLine" id="cb31-16" data-line-number="16"><span class="st">}</span></a>
<a class="sourceLine" id="cb31-17" data-line-number="17"><span class="st">}"</span>, </a>
<a class="sourceLine" id="cb31-18" data-line-number="18">    <span class="dt">fill =</span> <span class="ot">TRUE</span>, <span class="dt">file =</span> <span class="st">"lme_model1_1.txt"</span>)</a>
<a class="sourceLine" id="cb31-19" data-line-number="19"></a>
<a class="sourceLine" id="cb31-20" data-line-number="20"><span class="co"># Bundle data</span></a>
<a class="sourceLine" id="cb31-21" data-line-number="21">jags_data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">y =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(y), <span class="dt">subjects =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(subjects), <span class="dt">x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(x), </a>
<a class="sourceLine" id="cb31-22" data-line-number="22">    <span class="dt">n_subj =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(subjects)), <span class="dt">n_obs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(n_obs))</a>
<a class="sourceLine" id="cb31-23" data-line-number="23"><span class="co"># use as.numeric across the board for the data passed to JAGS; it might work</span></a>
<a class="sourceLine" id="cb31-24" data-line-number="24"><span class="co"># w/o it, but this is often needed for other BUGS packages</span></a>
<a class="sourceLine" id="cb31-25" data-line-number="25"></a>
<a class="sourceLine" id="cb31-26" data-line-number="26"><span class="co"># Inits function</span></a>
<a class="sourceLine" id="cb31-27" data-line-number="27">inits &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb31-28" data-line-number="28">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">alpha =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(n_subjects, <span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">beta =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">mu_int =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">1</span>, </a>
<a class="sourceLine" id="cb31-29" data-line-number="29">        <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">sigma_int =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">1</span>), <span class="dt">sigma_res =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb31-30" data-line-number="30">}</a>
<a class="sourceLine" id="cb31-31" data-line-number="31"></a>
<a class="sourceLine" id="cb31-32" data-line-number="32"><span class="co"># Parameters to estimate</span></a>
<a class="sourceLine" id="cb31-33" data-line-number="33">params &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"mu_int"</span>, <span class="st">"sigma_int"</span>, <span class="st">"sigma_res"</span>)</a>
<a class="sourceLine" id="cb31-34" data-line-number="34"></a>
<a class="sourceLine" id="cb31-35" data-line-number="35"><span class="co"># MCMC settings</span></a>
<a class="sourceLine" id="cb31-36" data-line-number="36">ni &lt;-<span class="st"> </span><span class="dv">11000</span></a>
<a class="sourceLine" id="cb31-37" data-line-number="37">nb &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb31-38" data-line-number="38">nt &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb31-39" data-line-number="39">nc &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb31-40" data-line-number="40"></a>
<a class="sourceLine" id="cb31-41" data-line-number="41"><span class="co"># Start Gibbs sampling</span></a>
<a class="sourceLine" id="cb31-42" data-line-number="42"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"R2jags"</span>)</a>
<a class="sourceLine" id="cb31-43" data-line-number="43">outj &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/R2jags/topics/jags">jags</a></span>(jags_data, <span class="dt">inits =</span> inits, <span class="dt">parameters.to.save =</span> params, <span class="dt">model.file =</span> <span class="st">"lme_model1_1.txt"</span>, </a>
<a class="sourceLine" id="cb31-44" data-line-number="44">    <span class="dt">n.thin =</span> nt, <span class="dt">n.chains =</span> nc, <span class="dt">n.burnin =</span> nb, <span class="dt">n.iter =</span> ni)</a></code></pre></div>
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 560
   Unobserved stochastic nodes: 60
   Total graph size: 2870

Initializing model</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">out &lt;-<span class="st"> </span>outj<span class="op">$</span>BUGSoutput</a>
<a class="sourceLine" id="cb33-2" data-line-number="2"></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="co"># Compare with MLEs and true values</span></a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">intercept_mean =</span> intercept_mean, <span class="dt">slope_mean =</span> slope_mean, <span class="dt">intercept_sd =</span> intercept_sd, </a>
<a class="sourceLine" id="cb33-5" data-line-number="5">    <span class="dt">slope_sd =</span> slope_sd, <span class="dt">sigma_res =</span> sigma_res)</a></code></pre></div>
<pre><code>  intercept_mean slope_mean intercept_sd slope_sd sigma_res
1            230         60           20       30        30</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>mean, <span class="dt">dig =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>$alpha
 [1]   2.2709  10.4368 -14.4434  27.8782 -27.4859   5.3887   9.0278
 [8]  21.3908 -33.4256  17.3239   4.7955  14.8499   7.4673 -58.6489
[15] -20.2960   5.8081   4.6564   2.8908   9.1343  41.5510   7.6757
[22]  -6.5620  12.8640 -16.8832  -1.3224  -7.6882  16.2645  -5.4239
[29]  -1.2459 -22.7099   0.7536   1.6020   2.5525  -0.1043  13.5993
[36]  -3.9203  29.4117 -32.5306 -29.0485  10.3896  14.2691  -5.8094
[43]   7.8443  -4.8366   6.2860  14.0609 -45.2007  22.5492  10.7770
[50]  18.1091 -17.9084  32.8588  -4.5668  -7.0149  -6.5487 -18.2486

$beta
[1] 59.26

$deviance
[1] 5773

$mu_int
[1] 229.8

$sigma_int
[1] 22.66

$sigma_res
[1] 41.98</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(lme_fit1, <span class="dt">cor =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: y ~ x + (1 | subjects)
REML criterion at convergence: 5836.374
Random effects:
 Groups   Name        Std.Dev.
 subjects (Intercept) 21.95   
 Residual             41.86   
Number of obs: 560, groups:  subjects, 56
Fixed Effects:
(Intercept)            x  
      230.1         59.3  </code></pre>
<div id="analysis-under-a-random-coefficients-model-without-correlation-between-intercept-and-slope" class="section level3">
<h3 class="hasAnchor">
<a href="#analysis-under-a-random-coefficients-model-without-correlation-between-intercept-and-slope" class="anchor"></a>Analysis under a random-coefficients model without correlation between intercept and slope</h3>
<p>REML analysis using R’s lme4 - which extends nlme with additional respone and link options</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">lme_fit2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/lme4/topics/lmer">lmer</a></span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>subjects) <span class="op">+</span><span class="st"> </span>(<span class="dv">0</span> <span class="op">+</span><span class="st"> </span>x <span class="op">|</span><span class="st"> </span>subjects))</a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(lme_fit2, <span class="dt">cor =</span> F)</a></code></pre></div>
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: y ~ x + (1 | subjects) + (0 + x | subjects)
REML criterion at convergence: 5618.902
Random effects:
 Groups     Name        Std.Dev.
 subjects   (Intercept) 22.28   
 subjects.1 x           29.73   
 Residual               29.98   
Number of obs: 560, groups:  subjects, 56
Fixed Effects:
(Intercept)            x  
     229.48        60.77  </code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/lme4/topics/fixef">fixef</a></span>(lme_fit2)</a></code></pre></div>
<pre><code>(Intercept)           x 
  229.47633    60.76964 </code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/lme4/topics/ranef">ranef</a></span>(lme_fit2)[[<span class="dv">1</span>]][, <span class="dv">1</span>], <span class="kw"><a href="https://www.rdocumentation.org/packages/lme4/topics/ranef">ranef</a></span>(lme_fit2)[[<span class="dv">1</span>]][, <span class="dv">2</span>], <span class="dt">main =</span> <span class="st">"fitted random effects"</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">coef.re &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(lme_fit2)</a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(coef.re[[<span class="dv">1</span>]][, <span class="dv">1</span>], coef.re[[<span class="dv">1</span>]][, <span class="dv">2</span>], <span class="dt">main =</span> <span class="st">"Coefficients "</span>, <span class="dt">ylab =</span> <span class="st">"(Intercept)"</span>, </a>
<a class="sourceLine" id="cb44-3" data-line-number="3">    <span class="dt">xlab =</span> <span class="st">"x"</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(lme_fit2, <span class="dt">cor =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: y ~ x + (1 | subjects) + (0 + x | subjects)
REML criterion at convergence: 5618.902
Random effects:
 Groups     Name        Std.Dev.
 subjects   (Intercept) 22.28   
 subjects.1 x           29.73   
 Residual               29.98   
Number of obs: 560, groups:  subjects, 56
Fixed Effects:
(Intercept)            x  
     229.48        60.77  </code></pre>
</div>
<div id="bayesian-analysis-using-jags-of-a-random-coefficients-model-without-correlation-between-intercept-and-slope" class="section level3">
<h3 class="hasAnchor">
<a href="#bayesian-analysis-using-jags-of-a-random-coefficients-model-without-correlation-between-intercept-and-slope" class="anchor"></a>Bayesian analysis using JAGS of a random-coefficients model without correlation between intercept and slope</h3>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="co"># Define model</span></a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"model {</span></a>
<a class="sourceLine" id="cb47-3" data-line-number="3"><span class="st"># Priors</span></a>
<a class="sourceLine" id="cb47-4" data-line-number="4"><span class="st">mu_int~dnorm(0, 0.001) # Mean hyperparameter for random intercepts</span></a>
<a class="sourceLine" id="cb47-5" data-line-number="5"><span class="st">sigma_int~dunif(0, 100) # SD hyperparameter for random intercepts</span></a>
<a class="sourceLine" id="cb47-6" data-line-number="6"><span class="st">tau_int &lt;- 1/(sigma_int*sigma_int)</span></a>
<a class="sourceLine" id="cb47-7" data-line-number="7"><span class="st">mu_slope~dnorm(0, 0.001) # Mean hyperparameter for random slopes</span></a>
<a class="sourceLine" id="cb47-8" data-line-number="8"><span class="st">sigma_slope~dunif(0, 100) # SD hyperparameter for slopes</span></a>
<a class="sourceLine" id="cb47-9" data-line-number="9"><span class="st">tau_slope &lt;- 1/(sigma_slope*sigma_slope)</span></a>
<a class="sourceLine" id="cb47-10" data-line-number="10"><span class="st">for (i in 1:n_subj) {</span></a>
<a class="sourceLine" id="cb47-11" data-line-number="11"><span class="st">    alpha[i]~dnorm(mu_int, tau_int) # Random intercepts</span></a>
<a class="sourceLine" id="cb47-12" data-line-number="12"><span class="st">    beta[i]~dnorm(mu_slope, tau_slope) # Random slopes</span></a>
<a class="sourceLine" id="cb47-13" data-line-number="13"><span class="st">}</span></a>
<a class="sourceLine" id="cb47-14" data-line-number="14"><span class="st">sigma_res~dunif(0, 100) # Residual standard deviation</span></a>
<a class="sourceLine" id="cb47-15" data-line-number="15"><span class="st">tau_res &lt;- 1/(sigma_res*sigma_res) # Residual precision</span></a>
<a class="sourceLine" id="cb47-16" data-line-number="16"><span class="st"># Likelihood</span></a>
<a class="sourceLine" id="cb47-17" data-line-number="17"><span class="st">for (i in 1:n_obs) {</span></a>
<a class="sourceLine" id="cb47-18" data-line-number="18"><span class="st">    mu[i] &lt;- alpha[subjects[i]]+beta[subjects[i]]*x[i]</span></a>
<a class="sourceLine" id="cb47-19" data-line-number="19"><span class="st">    y[i]~dnorm(mu[i], tau_res)</span></a>
<a class="sourceLine" id="cb47-20" data-line-number="20"><span class="st">}</span></a>
<a class="sourceLine" id="cb47-21" data-line-number="21"><span class="st">}"</span>, </a>
<a class="sourceLine" id="cb47-22" data-line-number="22">    <span class="dt">fill =</span> <span class="ot">TRUE</span>, <span class="dt">file =</span> <span class="st">"lme_model2.txt"</span>)</a>
<a class="sourceLine" id="cb47-23" data-line-number="23"></a>
<a class="sourceLine" id="cb47-24" data-line-number="24"><span class="co"># Bundle data</span></a>
<a class="sourceLine" id="cb47-25" data-line-number="25">jags_data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">y =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(y), <span class="dt">subjects =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(subjects), <span class="dt">x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(x), </a>
<a class="sourceLine" id="cb47-26" data-line-number="26">    <span class="dt">n_subj =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(subjects)), <span class="dt">n_obs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(n_obs))</a>
<a class="sourceLine" id="cb47-27" data-line-number="27"></a>
<a class="sourceLine" id="cb47-28" data-line-number="28"><span class="co"># Inits function</span></a>
<a class="sourceLine" id="cb47-29" data-line-number="29">inits &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb47-30" data-line-number="30">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">alpha =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(n_subjects, <span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">beta =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(n_subjects, <span class="dv">10</span>, <span class="dv">2</span>), <span class="dt">mu_int =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">1</span>, </a>
<a class="sourceLine" id="cb47-31" data-line-number="31">        <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">sigma_int =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">1</span>), <span class="dt">mu_slope =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">sigma_slope =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">1</span>), </a>
<a class="sourceLine" id="cb47-32" data-line-number="32">        <span class="dt">sigma_res =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb47-33" data-line-number="33">}</a>
<a class="sourceLine" id="cb47-34" data-line-number="34"></a>
<a class="sourceLine" id="cb47-35" data-line-number="35"><span class="co"># Parameters to estimate</span></a>
<a class="sourceLine" id="cb47-36" data-line-number="36">params &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"mu_int"</span>, <span class="st">"sigma_int"</span>, <span class="st">"mu_slope"</span>, <span class="st">"sigma_slope"</span>, </a>
<a class="sourceLine" id="cb47-37" data-line-number="37">    <span class="st">"sigma_res"</span>)</a>
<a class="sourceLine" id="cb47-38" data-line-number="38"></a>
<a class="sourceLine" id="cb47-39" data-line-number="39"><span class="co"># MCMC settings</span></a>
<a class="sourceLine" id="cb47-40" data-line-number="40">ni &lt;-<span class="st"> </span><span class="dv">11000</span></a>
<a class="sourceLine" id="cb47-41" data-line-number="41">nb &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb47-42" data-line-number="42">nt &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb47-43" data-line-number="43">nc &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb47-44" data-line-number="44"></a>
<a class="sourceLine" id="cb47-45" data-line-number="45"><span class="co"># Start Gibbs sampling</span></a>
<a class="sourceLine" id="cb47-46" data-line-number="46"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"R2jags"</span>)</a>
<a class="sourceLine" id="cb47-47" data-line-number="47">outj &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/R2jags/topics/jags">jags</a></span>(jags_data, <span class="dt">inits =</span> inits, <span class="dt">parameters.to.save =</span> params, <span class="dt">model.file =</span> <span class="st">"lme_model2.txt"</span>, </a>
<a class="sourceLine" id="cb47-48" data-line-number="48">    <span class="dt">n.thin =</span> nt, <span class="dt">n.chains =</span> nc, <span class="dt">n.burnin =</span> nb, <span class="dt">n.iter =</span> ni)</a></code></pre></div>
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 560
   Unobserved stochastic nodes: 117
   Total graph size: 2929

Initializing model</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">out &lt;-<span class="st"> </span>outj<span class="op">$</span>BUGSoutput</a>
<a class="sourceLine" id="cb49-2" data-line-number="2"></a>
<a class="sourceLine" id="cb49-3" data-line-number="3"><span class="co"># Compare with MLEs and true values</span></a>
<a class="sourceLine" id="cb49-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">intercept_mean =</span> intercept_mean, <span class="dt">slope_mean =</span> slope_mean, <span class="dt">intercept_sd =</span> intercept_sd, </a>
<a class="sourceLine" id="cb49-5" data-line-number="5">    <span class="dt">slope_sd =</span> slope_sd, <span class="dt">sigma_res =</span> sigma_res)</a></code></pre></div>
<pre><code>  intercept_mean slope_mean intercept_sd slope_sd sigma_res
1            230         60           20       30        30</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>mean, <span class="dt">dig =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>$alpha
 [1] 238.8 243.9 212.7 261.3 196.1 236.0 239.4 231.6 190.5 248.7 227.9
[12] 222.6 236.9 156.2 205.1 236.8 234.1 247.6 236.2 274.1 245.4 235.2
[23] 245.1 206.2 228.4 226.1 246.4 225.5 227.9 214.0 230.1 225.3 233.3
[34] 229.7 224.6 227.9 244.9 190.5 198.2 237.0 235.9 222.5 239.4 231.9
[45] 229.7 242.7 188.1 249.6 235.7 259.8 219.1 265.2 223.2 223.4 226.7
[56] 215.2

$beta
 [1]  24.93  36.89  55.00  59.59  73.75  60.27  66.98 105.39  26.71  45.45
[11]  12.29 101.62  65.73  42.44  39.24  61.03  53.19 109.25 116.57  49.81
[21]  81.00  29.94  53.25  20.97  68.64  37.36  57.81  76.09  58.10  93.17
[31]  57.31  43.06  53.33  61.11 113.58  98.66 -12.21  55.05  49.00 123.80
[41]  39.08  45.82  46.44  38.98  81.93  39.56  87.84  90.24  82.21  86.50
[51]  27.51  77.36  44.84  46.58  38.26  96.24

$deviance
[1] 5400

$mu_int
[1] 226.8

$mu_slope
[1] 59.63

$sigma_int
[1] 22.99

$sigma_res
[1] 30.1

$sigma_slope
[1] 30.38</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(lme_fit2, <span class="dt">cor =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: y ~ x + (1 | subjects) + (0 + x | subjects)
REML criterion at convergence: 5618.902
Random effects:
 Groups     Name        Std.Dev.
 subjects   (Intercept) 22.28   
 subjects.1 x           29.73   
 Residual               29.98   
Number of obs: 560, groups:  subjects, 56
Fixed Effects:
(Intercept)            x  
     229.48        60.77  </code></pre>
<p>Using simulated data and successfully recovering the input values makes us fairly confident that the JAGS analysis has been correctly specified. This is very helpful for more complex models b/c it’s easy to make mistakes. A good way to check the JAGS analysis for a custom model that is needed for a particular phenomenon is to simulate the data and run the JAGS model on that data</p>
</div>
<div id="the-random-coefficients-model-with-correlation-between-intercept-and-slope" class="section level3">
<h3 class="hasAnchor">
<a href="#the-random-coefficients-model-with-correlation-between-intercept-and-slope" class="anchor"></a>The random-coefficients model with correlation between intercept and slope</h3>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1">n_subjects &lt;-<span class="st"> </span><span class="dv">56</span></a>
<a class="sourceLine" id="cb55-2" data-line-number="2">n_sample &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb55-3" data-line-number="3">n_obs &lt;-<span class="st"> </span>n_subjects <span class="op">*</span><span class="st"> </span>n_sample</a>
<a class="sourceLine" id="cb55-4" data-line-number="4">subjects &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gl">gl</a></span>(<span class="dt">n =</span> n_subjects, <span class="dt">k =</span> n_sample)</a>
<a class="sourceLine" id="cb55-5" data-line-number="5"></a>
<a class="sourceLine" id="cb55-6" data-line-number="6"><span class="co"># Standardized continuous covariate:</span></a>
<a class="sourceLine" id="cb55-7" data-line-number="7">original_x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(n_obs, <span class="dv">45</span>, <span class="dv">70</span>)</a>
<a class="sourceLine" id="cb55-8" data-line-number="8">(mean_orig_x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(original_x))</a></code></pre></div>
<pre><code>[1] 56.56022</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1">sd_orig_x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/sd">sd</a></span>(original_x)</a>
<a class="sourceLine" id="cb57-2" data-line-number="2">x &lt;-<span class="st"> </span>(original_x <span class="op">-</span><span class="st"> </span>mean_orig_x)<span class="op">/</span>sd_orig_x</a>
<a class="sourceLine" id="cb57-3" data-line-number="3"></a>
<a class="sourceLine" id="cb57-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(x, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">20</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb57-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(x), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="co"># Design matrix:</span></a>
<a class="sourceLine" id="cb58-2" data-line-number="2">Xmat &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/model.matrix">model.matrix</a></span>(<span class="op">~</span>subjects <span class="op">*</span><span class="st"> </span>x <span class="op">-</span><span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x)</a>
<a class="sourceLine" id="cb58-3" data-line-number="3"></a>
<a class="sourceLine" id="cb58-4" data-line-number="4"><span class="co"># Generate the correlated random effects for intercept and slope: Assembling</span></a>
<a class="sourceLine" id="cb58-5" data-line-number="5"><span class="co"># the parameters for the multivariate normal distribution</span></a>
<a class="sourceLine" id="cb58-6" data-line-number="6">intercept_mean &lt;-<span class="st"> </span><span class="dv">230</span>  <span class="co"># Values for five hyperparameters</span></a>
<a class="sourceLine" id="cb58-7" data-line-number="7">intercept_sd &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb58-8" data-line-number="8">slope_mean &lt;-<span class="st"> </span><span class="dv">60</span></a>
<a class="sourceLine" id="cb58-9" data-line-number="9">slope_sd &lt;-<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb58-10" data-line-number="10">intercept_slope_covariance &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb58-11" data-line-number="11">intercept_slope_correlation &lt;-<span class="st"> </span>intercept_slope_covariance<span class="op">/</span>(intercept_sd <span class="op">*</span><span class="st"> </span>slope_sd)</a>
<a class="sourceLine" id="cb58-12" data-line-number="12"></a>
<a class="sourceLine" id="cb58-13" data-line-number="13">mu_vector &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(intercept_mean, slope_mean)</a>
<a class="sourceLine" id="cb58-14" data-line-number="14">var_covar_matrix &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(intercept_sd<span class="op">^</span><span class="dv">2</span>, intercept_slope_covariance, intercept_slope_covariance, </a>
<a class="sourceLine" id="cb58-15" data-line-number="15">    slope_sd<span class="op">^</span><span class="dv">2</span>), <span class="dv">2</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb58-16" data-line-number="16"></a>
<a class="sourceLine" id="cb58-17" data-line-number="17"><span class="co"># Generating the correlated random effects for intercepts and slopes:</span></a>
<a class="sourceLine" id="cb58-18" data-line-number="18"></a>
<a class="sourceLine" id="cb58-19" data-line-number="19"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"MASS"</span>)  <span class="co"># Load MASS to sample from a multivariate normal</span></a>
<a class="sourceLine" id="cb58-20" data-line-number="20">effects &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/MASS/topics/mvrnorm">mvrnorm</a></span>(<span class="dt">n =</span> n_subjects, <span class="dt">mu =</span> mu_vector, <span class="dt">Sigma =</span> var_covar_matrix)</a>
<a class="sourceLine" id="cb58-21" data-line-number="21"><span class="co">## round(effects, 2)</span></a>
<a class="sourceLine" id="cb58-22" data-line-number="22"></a>
<a class="sourceLine" id="cb58-23" data-line-number="23"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb58-24" data-line-number="24"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(effects[, <span class="dv">1</span>], <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb58-25" data-line-number="25"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(effects[, <span class="dv">1</span>]), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb58-26" data-line-number="26"></a>
<a class="sourceLine" id="cb58-27" data-line-number="27"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(effects[, <span class="dv">2</span>], <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb58-28" data-line-number="28"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(effects[, <span class="dv">2</span>]), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-8-2.png" width="700"></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb59-2" data-line-number="2"></a>
<a class="sourceLine" id="cb59-3" data-line-number="3"><span class="co"># Plotting the bivariate distribution:</span></a>
<a class="sourceLine" id="cb59-4" data-line-number="4">effects_kde &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/MASS/topics/kde2d">kde2d</a></span>(effects[, <span class="dv">1</span>], effects[, <span class="dv">2</span>], <span class="dt">n =</span> <span class="dv">50</span>)  <span class="co"># kernel density estimate</span></a>
<a class="sourceLine" id="cb59-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb59-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/contour">contour</a></span>(effects_kde)</a>
<a class="sourceLine" id="cb59-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/image">image</a></span>(effects_kde)</a>
<a class="sourceLine" id="cb59-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/persp">persp</a></span>(effects_kde, <span class="dt">phi =</span> <span class="dv">45</span>, <span class="dt">theta =</span> <span class="dv">30</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-8-3.png" width="700"></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="co"># even better:</span></a>
<a class="sourceLine" id="cb60-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb60-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/image">image</a></span>(effects_kde)</a>
<a class="sourceLine" id="cb60-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/contour">contour</a></span>(effects_kde, <span class="dt">add =</span> T)</a>
<a class="sourceLine" id="cb60-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/persp">persp</a></span>(effects_kde, <span class="dt">phi =</span> <span class="dv">45</span>, <span class="dt">theta =</span> <span class="dv">-30</span>, <span class="dt">shade =</span> <span class="fl">0.1</span>, <span class="dt">border =</span> <span class="ot">NULL</span>, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, </a>
<a class="sourceLine" id="cb60-6" data-line-number="6">    <span class="dt">ticktype =</span> <span class="st">"detailed"</span>, <span class="dt">xlab =</span> <span class="st">""</span>, <span class="dt">ylab =</span> <span class="st">""</span>, <span class="dt">zlab =</span> <span class="st">""</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-8-4.png" width="700"></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb61-2" data-line-number="2"></a>
<a class="sourceLine" id="cb61-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(effects, <span class="dv">2</span>, mean)</a></code></pre></div>
<pre><code>[1] 227.42785  67.18587</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(effects, <span class="dv">2</span>, sd)</a></code></pre></div>
<pre><code>[1] 16.77932 33.93159</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(effects, <span class="dv">2</span>, var)</a></code></pre></div>
<pre><code>[1]  281.5456 1151.3530</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">cov</a></span>(effects[, <span class="dv">1</span>], effects[, <span class="dv">2</span>])</a></code></pre></div>
<pre><code>[1] 81.98091</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(effects)</a></code></pre></div>
<pre><code>          [,1]       [,2]
[1,] 281.54561   81.98091
[2,]  81.98091 1151.35301</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1"><span class="co"># Population parameters</span></a>
<a class="sourceLine" id="cb71-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">intercept_mean =</span> intercept_mean, <span class="dt">slope_mean =</span> slope_mean, <span class="dt">intercept_sd =</span> intercept_sd, </a>
<a class="sourceLine" id="cb71-3" data-line-number="3">    <span class="dt">slope_sd =</span> slope_sd, <span class="dt">intercept_slope_covariance =</span> intercept_slope_covariance, </a>
<a class="sourceLine" id="cb71-4" data-line-number="4">    <span class="dt">sigma_res =</span> sigma_res)</a></code></pre></div>
<pre><code>  intercept_mean slope_mean intercept_sd slope_sd
1            230         60           20       30
  intercept_slope_covariance sigma_res
1                         10        30</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="co"># Sampling error for intercept-slope covariance (200 samples of 50, 500,</span></a>
<a class="sourceLine" id="cb73-2" data-line-number="2"><span class="co"># 5000 and 50000 group/random effects each) -- just to illustrate how</span></a>
<a class="sourceLine" id="cb73-3" data-line-number="3"><span class="co"># difficult it is to estimate measures of association, even from fairly</span></a>
<a class="sourceLine" id="cb73-4" data-line-number="4"><span class="co"># large data sets with 5000 observations:</span></a>
<a class="sourceLine" id="cb73-5" data-line-number="5"></a>
<a class="sourceLine" id="cb73-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb73-7" data-line-number="7">cov_temp1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">numeric</a></span>()</a>
<a class="sourceLine" id="cb73-8" data-line-number="8"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">200</span>) {</a>
<a class="sourceLine" id="cb73-9" data-line-number="9">    temp1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/MASS/topics/mvrnorm">mvrnorm</a></span>(<span class="dv">50</span>, <span class="dt">mu =</span> mu_vector, <span class="dt">Sigma =</span> var_covar_matrix)</a>
<a class="sourceLine" id="cb73-10" data-line-number="10">    cov_temp1[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(temp1)[<span class="dv">1</span>, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb73-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb73-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(cov_temp1, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"n_obs=50"</span>)</a>
<a class="sourceLine" id="cb73-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(cov_temp1), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb73-14" data-line-number="14"></a>
<a class="sourceLine" id="cb73-15" data-line-number="15">cov_temp2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">numeric</a></span>()</a>
<a class="sourceLine" id="cb73-16" data-line-number="16"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">200</span>) {</a>
<a class="sourceLine" id="cb73-17" data-line-number="17">    temp2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/MASS/topics/mvrnorm">mvrnorm</a></span>(<span class="dv">500</span>, <span class="dt">mu =</span> mu_vector, <span class="dt">Sigma =</span> var_covar_matrix)</a>
<a class="sourceLine" id="cb73-18" data-line-number="18">    cov_temp2[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(temp2)[<span class="dv">1</span>, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb73-19" data-line-number="19">}</a>
<a class="sourceLine" id="cb73-20" data-line-number="20"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(cov_temp2, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"n_obs=500"</span>)</a>
<a class="sourceLine" id="cb73-21" data-line-number="21"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(cov_temp2), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb73-22" data-line-number="22"></a>
<a class="sourceLine" id="cb73-23" data-line-number="23">cov_temp3 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">numeric</a></span>()</a>
<a class="sourceLine" id="cb73-24" data-line-number="24"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">200</span>) {</a>
<a class="sourceLine" id="cb73-25" data-line-number="25">    temp3 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/MASS/topics/mvrnorm">mvrnorm</a></span>(<span class="dv">5000</span>, <span class="dt">mu =</span> mu_vector, <span class="dt">Sigma =</span> var_covar_matrix)</a>
<a class="sourceLine" id="cb73-26" data-line-number="26">    cov_temp3[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(temp3)[<span class="dv">1</span>, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb73-27" data-line-number="27">}</a>
<a class="sourceLine" id="cb73-28" data-line-number="28"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(cov_temp3, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"n_obs=5000"</span>)</a>
<a class="sourceLine" id="cb73-29" data-line-number="29"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(cov_temp3), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb73-30" data-line-number="30"></a>
<a class="sourceLine" id="cb73-31" data-line-number="31">cov_temp4 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">numeric</a></span>()</a>
<a class="sourceLine" id="cb73-32" data-line-number="32"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">200</span>) {</a>
<a class="sourceLine" id="cb73-33" data-line-number="33">    temp4 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/MASS/topics/mvrnorm">mvrnorm</a></span>(<span class="dv">50000</span>, <span class="dt">mu =</span> mu_vector, <span class="dt">Sigma =</span> var_covar_matrix)</a>
<a class="sourceLine" id="cb73-34" data-line-number="34">    cov_temp4[i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(temp4)[<span class="dv">1</span>, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb73-35" data-line-number="35">}</a>
<a class="sourceLine" id="cb73-36" data-line-number="36"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(cov_temp4, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"n_obs=50000"</span>)</a>
<a class="sourceLine" id="cb73-37" data-line-number="37"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(cov_temp4), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-8-5.png" width="700"></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb74-2" data-line-number="2"></a>
<a class="sourceLine" id="cb74-3" data-line-number="3"></a>
<a class="sourceLine" id="cb74-4" data-line-number="4">intercept_effects &lt;-<span class="st"> </span>effects[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb74-5" data-line-number="5"><span class="co">## round(intercept_effects, 2)</span></a>
<a class="sourceLine" id="cb74-6" data-line-number="6">slope_effects &lt;-<span class="st"> </span>effects[, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb74-7" data-line-number="7"><span class="co">## round(slope_effects, 2)</span></a>
<a class="sourceLine" id="cb74-8" data-line-number="8">all_effects &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(intercept_effects, slope_effects)  <span class="co"># Put them all together</span></a>
<a class="sourceLine" id="cb74-9" data-line-number="9"><span class="co">## round(all_effects, 2)</span></a>
<a class="sourceLine" id="cb74-10" data-line-number="10"></a>
<a class="sourceLine" id="cb74-11" data-line-number="11"></a>
<a class="sourceLine" id="cb74-12" data-line-number="12"><span class="co"># Generate the response variable: -- the deterministic part</span></a>
<a class="sourceLine" id="cb74-13" data-line-number="13">lin_pred &lt;-<span class="st"> </span>Xmat <span class="op">%*%</span><span class="st"> </span>all_effects</a>
<a class="sourceLine" id="cb74-14" data-line-number="14"><span class="co">## round(as.vector(lin_pred), 2)</span></a>
<a class="sourceLine" id="cb74-15" data-line-number="15"></a>
<a class="sourceLine" id="cb74-16" data-line-number="16"><span class="co"># -- the stochastic part</span></a>
<a class="sourceLine" id="cb74-17" data-line-number="17">sigma_res &lt;-<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb74-18" data-line-number="18">normal_error &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dt">n =</span> n_obs, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> sigma_res)  <span class="co"># residuals</span></a>
<a class="sourceLine" id="cb74-19" data-line-number="19"></a>
<a class="sourceLine" id="cb74-20" data-line-number="20"><span class="co"># -- add them together</span></a>
<a class="sourceLine" id="cb74-21" data-line-number="21">y &lt;-<span class="st"> </span>lin_pred <span class="op">+</span><span class="st"> </span>normal_error</a>
<a class="sourceLine" id="cb74-22" data-line-number="22"><span class="co"># or, in one go:</span></a>
<a class="sourceLine" id="cb74-23" data-line-number="23">y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dt">n =</span> n_obs, <span class="dt">mean =</span> lin_pred, <span class="dt">sd =</span> sigma_res)</a>
<a class="sourceLine" id="cb74-24" data-line-number="24"></a>
<a class="sourceLine" id="cb74-25" data-line-number="25"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(y, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">15</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb74-26" data-line-number="26"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(y), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-8-6.png" width="700"></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"lattice"</span>)</a>
<a class="sourceLine" id="cb75-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/lattice/topics/xyplot">xyplot</a></span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">|</span><span class="st"> </span>subjects, <span class="dt">pch =</span> <span class="dv">20</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-8-7.png" width="700"></p>
<div id="reml-analysis-using-r" class="section level4">
<h4 class="hasAnchor">
<a href="#reml-analysis-using-r" class="anchor"></a>REML analysis using R</h4>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1">lme_fit3 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/lme4/topics/lmer">lmer</a></span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>(x <span class="op">|</span><span class="st"> </span>subjects))</a>
<a class="sourceLine" id="cb76-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(lme_fit3, <span class="dt">cor =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: y ~ x + (x | subjects)
REML criterion at convergence: 5623.412
Random effects:
 Groups   Name        Std.Dev. Corr
 subjects (Intercept) 16.13        
          x           35.84    0.20
 Residual             30.44        
Number of obs: 560, groups:  subjects, 56
Fixed Effects:
(Intercept)            x  
     227.34        66.91  </code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="co"># Compare with the true values:</span></a>
<a class="sourceLine" id="cb78-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">intercept_mean =</span> intercept_mean, <span class="dt">slope_mean =</span> slope_mean, <span class="dt">intercept_sd =</span> intercept_sd, </a>
<a class="sourceLine" id="cb78-3" data-line-number="3">    <span class="dt">slope_sd =</span> slope_sd, <span class="dt">intercept_slope_correlation =</span> intercept_slope_covariance<span class="op">/</span>(intercept_sd <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb78-4" data-line-number="4"><span class="st">        </span>slope_sd), <span class="dt">sigma_res =</span> sigma_res)</a></code></pre></div>
<pre><code>  intercept_mean slope_mean intercept_sd slope_sd
1            230         60           20       30
  intercept_slope_correlation sigma_res
1                  0.01666667        30</code></pre>
</div>
<div id="bayesian-analysis-using-jags" class="section level4">
<h4 class="hasAnchor">
<a href="#bayesian-analysis-using-jags" class="anchor"></a>Bayesian analysis using JAGS</h4>
<p>This is one way in which we can specify a Bayesian analysis of the random-coefficients model with correlation. It is more intuitive but does not generalize well to more than 2 correlated random effects. We will introduce a different and more general way to allow for correlation among two or more sets of random effects in a model after this.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="co"># Define model</span></a>
<a class="sourceLine" id="cb80-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"model {</span></a>
<a class="sourceLine" id="cb80-3" data-line-number="3"><span class="st"># Priors</span></a>
<a class="sourceLine" id="cb80-4" data-line-number="4"><span class="st">mu_int~dnorm(0, 0.0001) # mean for random intercepts</span></a>
<a class="sourceLine" id="cb80-5" data-line-number="5"><span class="st">mu_slope~dnorm(0, 0.0001) # mean for random slopes</span></a>
<a class="sourceLine" id="cb80-6" data-line-number="6"><span class="st">sigma_int~dunif(0, 100) # SD of intercepts</span></a>
<a class="sourceLine" id="cb80-7" data-line-number="7"><span class="st">sigma_slope~dunif(0, 100) # SD of slopes</span></a>
<a class="sourceLine" id="cb80-8" data-line-number="8"><span class="st">rho~dunif(-1, 1) # correlation between intercepts and slopes</span></a>
<a class="sourceLine" id="cb80-9" data-line-number="9"><span class="st">Sigma_B[1, 1] &lt;- pow(sigma_int, 2) # We start assembling the var-covar matrix for the random effects</span></a>
<a class="sourceLine" id="cb80-10" data-line-number="10"><span class="st">Sigma_B[2, 2] &lt;- pow(sigma_slope, 2)</span></a>
<a class="sourceLine" id="cb80-11" data-line-number="11"><span class="st">Sigma_B[1, 2] &lt;- rho*sigma_int*sigma_slope</span></a>
<a class="sourceLine" id="cb80-12" data-line-number="12"><span class="st">Sigma_B[2, 1] &lt;- Sigma_B[1, 2]</span></a>
<a class="sourceLine" id="cb80-13" data-line-number="13"><span class="st">covariance &lt;- Sigma_B[1, 2]</span></a>
<a class="sourceLine" id="cb80-14" data-line-number="14"><span class="st">Tau_B[1:2, 1:2] &lt;- inverse(Sigma_B[,])</span></a>
<a class="sourceLine" id="cb80-15" data-line-number="15"><span class="st">for (i in 1:n_subj) {</span></a>
<a class="sourceLine" id="cb80-16" data-line-number="16"><span class="st">    B_hat[i, 1] &lt;- mu_int</span></a>
<a class="sourceLine" id="cb80-17" data-line-number="17"><span class="st">    B_hat[i, 2] &lt;- mu_slope</span></a>
<a class="sourceLine" id="cb80-18" data-line-number="18"><span class="st">    B[i, 1:2]~dmnorm(B_hat[i, ], Tau_B[,]) # the pairs of correlated random effects</span></a>
<a class="sourceLine" id="cb80-19" data-line-number="19"><span class="st">    alpha[i] &lt;- B[i, 1] # random intercept</span></a>
<a class="sourceLine" id="cb80-20" data-line-number="20"><span class="st">    beta[i] &lt;- B[i, 2] # random slope</span></a>
<a class="sourceLine" id="cb80-21" data-line-number="21"><span class="st">}</span></a>
<a class="sourceLine" id="cb80-22" data-line-number="22"><span class="st">sigma_res~dunif(0, 100) # Residual standard deviation</span></a>
<a class="sourceLine" id="cb80-23" data-line-number="23"><span class="st">tau_res &lt;- 1/(sigma_res*sigma_res)</span></a>
<a class="sourceLine" id="cb80-24" data-line-number="24"><span class="st"># Likelihood</span></a>
<a class="sourceLine" id="cb80-25" data-line-number="25"><span class="st">for (i in 1:n_obs) {</span></a>
<a class="sourceLine" id="cb80-26" data-line-number="26"><span class="st">    mu[i] &lt;- alpha[subjects[i]]+beta[subjects[i]]*x[i]</span></a>
<a class="sourceLine" id="cb80-27" data-line-number="27"><span class="st">    y[i]~dnorm(mu[i], tau_res)</span></a>
<a class="sourceLine" id="cb80-28" data-line-number="28"><span class="st">}</span></a>
<a class="sourceLine" id="cb80-29" data-line-number="29"><span class="st">}"</span>, </a>
<a class="sourceLine" id="cb80-30" data-line-number="30">    <span class="dt">fill =</span> <span class="ot">TRUE</span>, <span class="dt">file =</span> <span class="st">"lme_model3.txt"</span>)</a>
<a class="sourceLine" id="cb80-31" data-line-number="31"></a>
<a class="sourceLine" id="cb80-32" data-line-number="32"><span class="co"># Bundle data</span></a>
<a class="sourceLine" id="cb80-33" data-line-number="33">jags_data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">y =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(y), <span class="dt">subjects =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(subjects), <span class="dt">x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(x), </a>
<a class="sourceLine" id="cb80-34" data-line-number="34">    <span class="dt">n_subj =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(subjects)), <span class="dt">n_obs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(n_obs))</a>
<a class="sourceLine" id="cb80-35" data-line-number="35"></a>
<a class="sourceLine" id="cb80-36" data-line-number="36"><span class="co"># Inits function</span></a>
<a class="sourceLine" id="cb80-37" data-line-number="37">inits &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb80-38" data-line-number="38">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">mu_int =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">sigma_int =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">1</span>), <span class="dt">mu_slope =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">1</span>, </a>
<a class="sourceLine" id="cb80-39" data-line-number="39">        <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">sigma_slope =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">1</span>), <span class="dt">rho =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">1</span>), <span class="dt">sigma_res =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb80-40" data-line-number="40">}</a>
<a class="sourceLine" id="cb80-41" data-line-number="41"></a>
<a class="sourceLine" id="cb80-42" data-line-number="42"><span class="co"># Parameters to estimate</span></a>
<a class="sourceLine" id="cb80-43" data-line-number="43">params &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"mu_int"</span>, <span class="st">"sigma_int"</span>, <span class="st">"mu_slope"</span>, <span class="st">"sigma_slope"</span>, </a>
<a class="sourceLine" id="cb80-44" data-line-number="44">    <span class="st">"rho"</span>, <span class="st">"covariance"</span>, <span class="st">"sigma_res"</span>)</a>
<a class="sourceLine" id="cb80-45" data-line-number="45"></a>
<a class="sourceLine" id="cb80-46" data-line-number="46"><span class="co"># MCMC settings</span></a>
<a class="sourceLine" id="cb80-47" data-line-number="47">ni &lt;-<span class="st"> </span><span class="dv">3200</span></a>
<a class="sourceLine" id="cb80-48" data-line-number="48">nb &lt;-<span class="st"> </span><span class="dv">200</span></a>
<a class="sourceLine" id="cb80-49" data-line-number="49">nt &lt;-<span class="st"> </span><span class="dv">6</span></a>
<a class="sourceLine" id="cb80-50" data-line-number="50">nc &lt;-<span class="st"> </span><span class="dv">3</span>  <span class="co"># more than this probably needed for a good approx. of the posterior distribution</span></a>
<a class="sourceLine" id="cb80-51" data-line-number="51"></a>
<a class="sourceLine" id="cb80-52" data-line-number="52"><span class="co"># Start Gibbs sampler</span></a>
<a class="sourceLine" id="cb80-53" data-line-number="53"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"R2jags"</span>)</a>
<a class="sourceLine" id="cb80-54" data-line-number="54">outj &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/R2jags/topics/jags">jags</a></span>(jags_data, <span class="dt">inits =</span> inits, <span class="dt">parameters.to.save =</span> params, <span class="dt">model.file =</span> <span class="st">"lme_model3.txt"</span>, </a>
<a class="sourceLine" id="cb80-55" data-line-number="55">    <span class="dt">n.thin =</span> nt, <span class="dt">n.chains =</span> nc, <span class="dt">n.burnin =</span> nb, <span class="dt">n.iter =</span> ni)</a></code></pre></div>
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 560
   Unobserved stochastic nodes: 62
   Total graph size: 3045

Initializing model</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1"><span class="co"># traceplot(outj)</span></a>
<a class="sourceLine" id="cb82-2" data-line-number="2"></a>
<a class="sourceLine" id="cb82-3" data-line-number="3"><span class="co"># -- this type of model does not converge very fast in addition to the fact</span></a>
<a class="sourceLine" id="cb82-4" data-line-number="4"><span class="co"># that it does not generalize very well; we increase the number of</span></a>
<a class="sourceLine" id="cb82-5" data-line-number="5"><span class="co"># iterations</span></a>
<a class="sourceLine" id="cb82-6" data-line-number="6"></a>
<a class="sourceLine" id="cb82-7" data-line-number="7">ni &lt;-<span class="st"> </span><span class="dv">25000</span></a>
<a class="sourceLine" id="cb82-8" data-line-number="8">nb &lt;-<span class="st"> </span><span class="dv">5000</span></a>
<a class="sourceLine" id="cb82-9" data-line-number="9">nt &lt;-<span class="st"> </span><span class="dv">40</span></a>
<a class="sourceLine" id="cb82-10" data-line-number="10">nc &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb82-11" data-line-number="11">outj &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/R2jags/topics/jags">jags</a></span>(jags_data, <span class="dt">inits =</span> inits, <span class="dt">parameters.to.save =</span> params, <span class="dt">model.file =</span> <span class="st">"lme_model3.txt"</span>, </a>
<a class="sourceLine" id="cb82-12" data-line-number="12">    <span class="dt">n.thin =</span> nt, <span class="dt">n.chains =</span> nc, <span class="dt">n.burnin =</span> nb, <span class="dt">n.iter =</span> ni)</a></code></pre></div>
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 560
   Unobserved stochastic nodes: 62
   Total graph size: 3045

Initializing model</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="co"># traceplot(outj)</span></a>
<a class="sourceLine" id="cb84-2" data-line-number="2"></a>
<a class="sourceLine" id="cb84-3" data-line-number="3"><span class="co"># print(outj, dig = 3)</span></a>
<a class="sourceLine" id="cb84-4" data-line-number="4"></a>
<a class="sourceLine" id="cb84-5" data-line-number="5">out &lt;-<span class="st"> </span>outj<span class="op">$</span>BUGSoutput</a>
<a class="sourceLine" id="cb84-6" data-line-number="6"></a>
<a class="sourceLine" id="cb84-7" data-line-number="7"><span class="co"># Compare with MLEs and true values</span></a>
<a class="sourceLine" id="cb84-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">intercept_mean =</span> intercept_mean, <span class="dt">slope_mean =</span> slope_mean, <span class="dt">intercept_sd =</span> intercept_sd, </a>
<a class="sourceLine" id="cb84-9" data-line-number="9">    <span class="dt">slope_sd =</span> slope_sd, <span class="dt">intercept_slope_correlation =</span> intercept_slope_covariance<span class="op">/</span>(intercept_sd <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb84-10" data-line-number="10"><span class="st">        </span>slope_sd), <span class="dt">sigma_res =</span> sigma_res)</a></code></pre></div>
<pre><code>  intercept_mean slope_mean intercept_sd slope_sd
1            230         60           20       30
  intercept_slope_correlation sigma_res
1                  0.01666667        30</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>mean, <span class="dt">dig =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>$alpha
 [1] 241.2 229.9 222.2 210.9 226.8 215.9 226.7 235.4 218.6 249.7 226.3
[12] 208.6 210.6 248.6 227.7 248.8 216.9 238.6 237.5 224.5 206.4 212.8
[23] 205.7 232.5 206.1 237.8 223.7 231.9 226.9 217.8 212.1 236.0 217.4
[34] 212.0 230.1 249.2 238.2 236.1 207.7 225.1 245.9 230.6 255.6 235.6
[45] 242.0 228.8 229.1 229.8 228.8 243.0 229.8 247.9 232.7 211.8 198.8
[56] 207.2

$beta
 [1]  90.136  -1.942  73.322 100.092  48.294  48.478  69.448  46.859
 [9]  80.642 140.795 107.413 100.922  44.346  50.389  47.578  93.179
[17]  81.650  33.825 138.515  80.039  45.557  53.151  31.125  47.575
[25]  16.620  85.760  28.139  63.764  10.740  43.387  78.131  87.679
[33]  18.507  47.810  52.994  72.816  60.297   9.777  92.375 105.141
[41]  62.877  73.779 148.255  22.881  35.018  32.572 102.500  68.082
[49]  98.681 113.603  67.028  84.408  96.501  31.837  57.003 128.769

$covariance
[1] 117.9

$deviance
[1] 5418

$mu_int
[1] 227.2

$mu_slope
[1] 66.59

$rho
[1] 0.1895

$sigma_int
[1] 16.65

$sigma_res
[1] 30.58

$sigma_slope
[1] 37</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(lme_fit3, <span class="dt">cor =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: y ~ x + (x | subjects)
REML criterion at convergence: 5623.412
Random effects:
 Groups   Name        Std.Dev. Corr
 subjects (Intercept) 16.13        
          x           35.84    0.20
 Residual             30.44        
Number of obs: 560, groups:  subjects, 56
Fixed Effects:
(Intercept)            x  
     227.34        66.91  </code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="co"># Note the very large SD for the posterior distribution of the covariance</span></a>
<a class="sourceLine" id="cb90-2" data-line-number="2"><span class="co"># (relative to the mean):</span></a>
<a class="sourceLine" id="cb90-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>mean<span class="op">$</span>covariance, <span class="dt">dig =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>[1] 118</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>sd<span class="op">$</span>covariance, <span class="dt">dig =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>[1] 106</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>mean<span class="op">$</span>rho, <span class="dt">dig =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>[1] 0.19</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>sd<span class="op">$</span>rho, <span class="dt">dig =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>[1] 0.16</code></pre>
<p>R does not even provide an SE for the covariance estimator (equivalently, for the correlation of random effects). Covariances are even harder to reliably estimate than variances, which are harder than mean estimators (it’s easy to estimate measures of center / location, harder to estimate measures of dispersion and even harder to estimate measures of association)</p>
<p>MODELING CORRELATED RANEFS WITH A SCALED INVERSE WISHART: the 2 correlated ranefs case first.</p>
<p>We will now introduce an alternative way of placing priors over correlated random effects that both converges faster and generalizes to structures with more than 2 correlated random effects. See the relevant chapter of Gelman &amp; Hill (2007) for more introductory discussion and references</p>
<p>Bayesian analysis using a scaled Inverse Wishart</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1"><span class="co"># Define model</span></a>
<a class="sourceLine" id="cb98-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"model {</span></a>
<a class="sourceLine" id="cb98-3" data-line-number="3"></a>
<a class="sourceLine" id="cb98-4" data-line-number="4"><span class="st"># Set up the means for the multivariate ranef distribution</span></a>
<a class="sourceLine" id="cb98-5" data-line-number="5"><span class="st">for (i in 1:2) {</span></a>
<a class="sourceLine" id="cb98-6" data-line-number="6"><span class="st">    xi[i]~dunif(0, 100) # scaling for the multivariate ranef distribution (for means, sds, and the ranefs themselves)</span></a>
<a class="sourceLine" id="cb98-7" data-line-number="7"><span class="st">    mu_raw[i]~dnorm(0, .0001) # unscaled means for the multivariate ranef distribution</span></a>
<a class="sourceLine" id="cb98-8" data-line-number="8"><span class="st">    mu[i] &lt;- xi[i]*mu_raw[i] # scaled means for the multivariate ranef distribution</span></a>
<a class="sourceLine" id="cb98-9" data-line-number="9"><span class="st">}</span></a>
<a class="sourceLine" id="cb98-10" data-line-number="10"><span class="st">mu_int &lt;- mu[1] # mean for random intercepts</span></a>
<a class="sourceLine" id="cb98-11" data-line-number="11"><span class="st">mu_slope &lt;- mu[2] # mean for random slopes</span></a>
<a class="sourceLine" id="cb98-12" data-line-number="12"></a>
<a class="sourceLine" id="cb98-13" data-line-number="13"><span class="st"># Set up the var-covar matrix for the multivariate ranef distribution</span></a>
<a class="sourceLine" id="cb98-14" data-line-number="14"><span class="st">Tau_B_raw[1:2, 1:2] ~ dwish(W[,], 3) # W is the identity matrix, provided as data; we have 3 dofs, i.e., 2 ranefs + 1, to ensure a uniform (-1, 1) prior for the correlation between ranefs</span></a>
<a class="sourceLine" id="cb98-15" data-line-number="15"><span class="st">Sigma_B_raw[1:2, 1:2] &lt;- inverse(Tau_B_raw[,])</span></a>
<a class="sourceLine" id="cb98-16" data-line-number="16"><span class="st">for (i in 1:2) {</span></a>
<a class="sourceLine" id="cb98-17" data-line-number="17"><span class="st">    sigma[i] &lt;- xi[i]*sqrt(Sigma_B_raw[i, i])</span></a>
<a class="sourceLine" id="cb98-18" data-line-number="18"><span class="st">}</span></a>
<a class="sourceLine" id="cb98-19" data-line-number="19"><span class="st">sigma_int &lt;- sigma[1] # SD of intercepts</span></a>
<a class="sourceLine" id="cb98-20" data-line-number="20"><span class="st">sigma_slope &lt;- sigma[2] # SD of slopes</span></a>
<a class="sourceLine" id="cb98-21" data-line-number="21"><span class="st">for (i in 1:2) { for (j in 1:2) {</span></a>
<a class="sourceLine" id="cb98-22" data-line-number="22"><span class="st">    rho[i, j] &lt;- Sigma_B_raw[i, j]/sqrt(Sigma_B_raw[i, i]*Sigma_B_raw[j, j])</span></a>
<a class="sourceLine" id="cb98-23" data-line-number="23"><span class="st">} }</span></a>
<a class="sourceLine" id="cb98-24" data-line-number="24"><span class="st">rho_int_slope &lt;- rho[1, 2]</span></a>
<a class="sourceLine" id="cb98-25" data-line-number="25"><span class="st">covariance &lt;- rho_int_slope*sigma_int*sigma_slope</span></a>
<a class="sourceLine" id="cb98-26" data-line-number="26"></a>
<a class="sourceLine" id="cb98-27" data-line-number="27"><span class="st"># The multivariate ranef distribution, i.e., modeling the correlated ranefs</span></a>
<a class="sourceLine" id="cb98-28" data-line-number="28"><span class="st">for (j in 1:n_subj) {</span></a>
<a class="sourceLine" id="cb98-29" data-line-number="29"><span class="ch">\t</span><span class="st">B_raw_hat[j, 1] &lt;- mu_raw[1]</span></a>
<a class="sourceLine" id="cb98-30" data-line-number="30"><span class="ch">\t</span><span class="st">B_raw_hat[j, 2] &lt;- mu_raw[2]</span></a>
<a class="sourceLine" id="cb98-31" data-line-number="31"><span class="ch">\t</span><span class="st">B_raw[j, 1:2] ~ dmnorm(B_raw_hat[j, ], Tau_B_raw[, ]) # the pairs of unscaled (raw) correlated random effects</span></a>
<a class="sourceLine" id="cb98-32" data-line-number="32"><span class="ch">\t</span><span class="st">alpha[j] &lt;- xi[1]*B_raw[j, 1] # random intercept</span></a>
<a class="sourceLine" id="cb98-33" data-line-number="33"><span class="st">    beta[j] &lt;- xi[2]*B_raw[j, 2] # random slope</span></a>
<a class="sourceLine" id="cb98-34" data-line-number="34"><span class="st">}</span></a>
<a class="sourceLine" id="cb98-35" data-line-number="35"></a>
<a class="sourceLine" id="cb98-36" data-line-number="36"><span class="st"># Model the resid. sd independently</span></a>
<a class="sourceLine" id="cb98-37" data-line-number="37"><span class="st">sigma_res~dunif(0, 100) # Residual standard deviation</span></a>
<a class="sourceLine" id="cb98-38" data-line-number="38"><span class="st">tau_res &lt;- 1/(sigma_res*sigma_res)</span></a>
<a class="sourceLine" id="cb98-39" data-line-number="39"></a>
<a class="sourceLine" id="cb98-40" data-line-number="40"><span class="st"># Likelihood</span></a>
<a class="sourceLine" id="cb98-41" data-line-number="41"><span class="st">for (i in 1:n_obs) {</span></a>
<a class="sourceLine" id="cb98-42" data-line-number="42"><span class="st">    mu_obs[i] &lt;- alpha[subjects[i]]+beta[subjects[i]]*x[i]</span></a>
<a class="sourceLine" id="cb98-43" data-line-number="43"><span class="st">    y[i]~dnorm(mu_obs[i], tau_res)</span></a>
<a class="sourceLine" id="cb98-44" data-line-number="44"><span class="st">}</span></a>
<a class="sourceLine" id="cb98-45" data-line-number="45"></a>
<a class="sourceLine" id="cb98-46" data-line-number="46"><span class="st"># Sampling from the prior: given that we do not place hyperpriors directly on the means, sds and correlation(s) of the multivariate ranef distribution, we want to sample from the prior to make sure we didn't accidentally make it more informed than we wanted (and we want it very vague)</span></a>
<a class="sourceLine" id="cb98-47" data-line-number="47"><span class="st">for (i in 1:2) {</span></a>
<a class="sourceLine" id="cb98-48" data-line-number="48"><span class="st">    xi_prior[i]~dunif(0, 100)</span></a>
<a class="sourceLine" id="cb98-49" data-line-number="49"><span class="st">    mu_raw_prior[i]~dnorm(0, .0001)</span></a>
<a class="sourceLine" id="cb98-50" data-line-number="50"><span class="st">    mu_prior[i] &lt;- xi_prior[i]*mu_raw_prior[i]</span></a>
<a class="sourceLine" id="cb98-51" data-line-number="51"><span class="st">}</span></a>
<a class="sourceLine" id="cb98-52" data-line-number="52"><span class="st">mu_int_prior &lt;- mu_prior[1]</span></a>
<a class="sourceLine" id="cb98-53" data-line-number="53"><span class="st">mu_slope_prior &lt;- mu_prior[2]</span></a>
<a class="sourceLine" id="cb98-54" data-line-number="54"><span class="st">Tau_B_raw_prior[1:2, 1:2] ~ dwish(W[,], 3)</span></a>
<a class="sourceLine" id="cb98-55" data-line-number="55"><span class="st">Sigma_B_raw_prior[1:2, 1:2] &lt;- inverse(Tau_B_raw_prior[,])</span></a>
<a class="sourceLine" id="cb98-56" data-line-number="56"><span class="st">for (i in 1:2) {</span></a>
<a class="sourceLine" id="cb98-57" data-line-number="57"><span class="st">    sigma_prior[i] &lt;- xi_prior[i]*sqrt(Sigma_B_raw_prior[i, i])</span></a>
<a class="sourceLine" id="cb98-58" data-line-number="58"><span class="st">}</span></a>
<a class="sourceLine" id="cb98-59" data-line-number="59"><span class="st">sigma_int_prior &lt;- sigma_prior[1]</span></a>
<a class="sourceLine" id="cb98-60" data-line-number="60"><span class="st">sigma_slope_prior &lt;- sigma_prior[2]</span></a>
<a class="sourceLine" id="cb98-61" data-line-number="61"><span class="st">for (i in 1:2) { for (j in 1:2) {</span></a>
<a class="sourceLine" id="cb98-62" data-line-number="62"><span class="st">    rho_prior[i, j] &lt;- Sigma_B_raw_prior[i, j]/sqrt(Sigma_B_raw_prior[i, i]*Sigma_B_raw_prior[j, j])</span></a>
<a class="sourceLine" id="cb98-63" data-line-number="63"><span class="st">} }</span></a>
<a class="sourceLine" id="cb98-64" data-line-number="64"><span class="st">rho_int_slope_prior &lt;- rho_prior[1, 2]</span></a>
<a class="sourceLine" id="cb98-65" data-line-number="65"><span class="st">}"</span>, </a>
<a class="sourceLine" id="cb98-66" data-line-number="66">    <span class="dt">fill =</span> <span class="ot">TRUE</span>, <span class="dt">file =</span> <span class="st">"lme_model4.txt"</span>)</a>
<a class="sourceLine" id="cb98-67" data-line-number="67"></a>
<a class="sourceLine" id="cb98-68" data-line-number="68"><span class="co"># Bundle data</span></a>
<a class="sourceLine" id="cb98-69" data-line-number="69">jags_data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">y =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(y), <span class="dt">subjects =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(subjects), <span class="dt">x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(x), </a>
<a class="sourceLine" id="cb98-70" data-line-number="70">    <span class="dt">n_subj =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(subjects)), <span class="dt">n_obs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(n_obs), <span class="dt">W =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diag">diag</a></span>(<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb98-71" data-line-number="71"></a>
<a class="sourceLine" id="cb98-72" data-line-number="72"><span class="co"># install.packages('bayesm')</span></a>
<a class="sourceLine" id="cb98-73" data-line-number="73"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"bayesm"</span>)</a>
<a class="sourceLine" id="cb98-74" data-line-number="74">var_vec &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(lme_fit3)<span class="op">$</span>subjects, <span class="dv">2</span>, var)</a>
<a class="sourceLine" id="cb98-75" data-line-number="75"></a>
<a class="sourceLine" id="cb98-76" data-line-number="76"><span class="co"># Inits function</span></a>
<a class="sourceLine" id="cb98-77" data-line-number="77">inits &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb98-78" data-line-number="78">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">xi =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">2</span>), <span class="dt">mu_raw =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">2</span>), <span class="dt">Tau_B_raw =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/bayesm/topics/rwishart">rwishart</a></span>(<span class="dv">3</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diag">diag</a></span>(<span class="dv">2</span>) <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb98-79" data-line-number="79"><span class="st">        </span>var_vec)<span class="op">$</span>W, <span class="dt">sigma_res =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">1</span>), <span class="dt">xi_prior =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">2</span>), <span class="dt">mu_raw_prior =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">2</span>), </a>
<a class="sourceLine" id="cb98-80" data-line-number="80">        <span class="dt">Tau_B_raw_prior =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/bayesm/topics/rwishart">rwishart</a></span>(<span class="dv">3</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diag">diag</a></span>(<span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>var_vec)<span class="op">$</span>W)</a>
<a class="sourceLine" id="cb98-81" data-line-number="81">}</a>
<a class="sourceLine" id="cb98-82" data-line-number="82"></a>
<a class="sourceLine" id="cb98-83" data-line-number="83"><span class="co"># Parameters to estimate</span></a>
<a class="sourceLine" id="cb98-84" data-line-number="84">params &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"mu"</span>, <span class="st">"mu_int"</span>, <span class="st">"mu_slope"</span>, <span class="st">"sigma"</span>, <span class="st">"sigma_int"</span>, <span class="st">"sigma_slope"</span>, </a>
<a class="sourceLine" id="cb98-85" data-line-number="85">    <span class="st">"rho"</span>, <span class="st">"rho_int_slope"</span>, <span class="st">"covariance"</span>, <span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"sigma_res"</span>, <span class="st">"mu_int_prior"</span>, </a>
<a class="sourceLine" id="cb98-86" data-line-number="86">    <span class="st">"mu_slope_prior"</span>, <span class="st">"sigma_int_prior"</span>, <span class="st">"sigma_slope_prior"</span>, <span class="st">"rho_int_slope_prior"</span>)</a>
<a class="sourceLine" id="cb98-87" data-line-number="87"></a>
<a class="sourceLine" id="cb98-88" data-line-number="88"><span class="co"># MCMC settings</span></a>
<a class="sourceLine" id="cb98-89" data-line-number="89">ni &lt;-<span class="st"> </span><span class="dv">7000</span></a>
<a class="sourceLine" id="cb98-90" data-line-number="90">nb &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb98-91" data-line-number="91">nt &lt;-<span class="st"> </span><span class="dv">6</span></a>
<a class="sourceLine" id="cb98-92" data-line-number="92">nc &lt;-<span class="st"> </span><span class="dv">3</span>  <span class="co"># more than this probably needed for a good approx. of the posterior distribution</span></a>
<a class="sourceLine" id="cb98-93" data-line-number="93"></a>
<a class="sourceLine" id="cb98-94" data-line-number="94"><span class="co"># Start Gibbs sampler</span></a>
<a class="sourceLine" id="cb98-95" data-line-number="95"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"R2jags"</span>)</a>
<a class="sourceLine" id="cb98-96" data-line-number="96">outj &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/R2jags/topics/jags">jags</a></span>(jags_data, <span class="dt">inits =</span> inits, <span class="dt">parameters.to.save =</span> params, <span class="dt">model.file =</span> <span class="st">"lme_model4.txt"</span>, </a>
<a class="sourceLine" id="cb98-97" data-line-number="97">    <span class="dt">n.thin =</span> nt, <span class="dt">n.chains =</span> nc, <span class="dt">n.burnin =</span> nb, <span class="dt">n.iter =</span> ni)</a></code></pre></div>
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 560
   Unobserved stochastic nodes: 67
   Total graph size: 3208

Initializing model</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1">out &lt;-<span class="st"> </span>outj<span class="op">$</span>BUGSoutput</a>
<a class="sourceLine" id="cb100-2" data-line-number="2"></a>
<a class="sourceLine" id="cb100-3" data-line-number="3"><span class="co"># Compare with MLEs and true values</span></a>
<a class="sourceLine" id="cb100-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">intercept_mean =</span> intercept_mean, <span class="dt">slope_mean =</span> slope_mean, <span class="dt">intercept_sd =</span> intercept_sd, </a>
<a class="sourceLine" id="cb100-5" data-line-number="5">    <span class="dt">slope_sd =</span> slope_sd, <span class="dt">intercept_slope_correlation =</span> intercept_slope_covariance<span class="op">/</span>(intercept_sd <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb100-6" data-line-number="6"><span class="st">        </span>slope_sd), <span class="dt">sigma_res =</span> sigma_res)</a></code></pre></div>
<pre><code>  intercept_mean slope_mean intercept_sd slope_sd
1            230         60           20       30
  intercept_slope_correlation sigma_res
1                  0.01666667        30</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>mean, <span class="dt">dig =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>$alpha
 [1] 236.9 229.2 224.9 217.6 227.5 220.3 227.4 232.8 222.2 241.8 227.3
[12] 216.5 217.1 241.1 228.0 241.6 221.3 234.8 234.6 226.1 214.0 218.6
[23] 214.2 230.8 214.2 234.5 225.4 230.5 227.4 221.6 218.0 233.6 221.4
[34] 218.1 229.6 241.5 234.8 233.6 215.8 226.3 239.5 230.0 246.4 233.2
[45] 236.9 228.5 229.3 229.3 228.7 237.8 229.6 240.8 231.6 217.4 209.6
[56] 215.0

$beta
 [1] 59.916 -1.062 48.597 66.781 31.965 32.319 46.089 31.344 53.003 93.081
[11] 71.368 66.885 29.327 33.849 31.702 62.291 54.219 22.366 92.009 52.940
[21] 30.166 35.145 21.261 32.080 11.397 56.996 18.593 42.350  7.529 28.936
[31] 51.466 58.459 12.565 32.024 35.350 48.354 40.259  6.597 60.820 70.124
[41] 41.987 49.082 98.104 15.720 23.587 22.269 68.036 45.266 65.522 75.537
[51] 44.616 56.612 64.249 21.236 38.249 84.889

$covariance
[1] 76.92

$deviance
[1] 5793

$mu
[1] 227.7  44.4

$mu_int
[1] 227.7

$mu_int_prior
[1] -96.53

$mu_slope
[1] 44.4

$mu_slope_prior
[1] -136.9

$rho
       [,1]   [,2]
[1,] 1.0000 0.1807
[2,] 0.1807 1.0000

$rho_int_slope
[1] 0.1807

$rho_int_slope_prior
[1] 0.01562

$sigma
[1] 10.61 23.60

$sigma_int
[1] 10.61

$sigma_int_prior
[1] 59.83

$sigma_res
[1] 48.1

$sigma_slope
[1] 23.6

$sigma_slope_prior
[1] 62.51</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(lme_fit3, <span class="dt">cor =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: y ~ x + (x | subjects)
REML criterion at convergence: 5623.412
Random effects:
 Groups   Name        Std.Dev. Corr
 subjects (Intercept) 16.13        
          x           35.84    0.20
 Residual             30.44        
Number of obs: 560, groups:  subjects, 56
Fixed Effects:
(Intercept)            x  
     227.34        66.91  </code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1"><span class="co"># Once again, note the very large SD for the posterior distribution of the</span></a>
<a class="sourceLine" id="cb106-2" data-line-number="2"><span class="co"># covariance (relative to the mean):</span></a>
<a class="sourceLine" id="cb106-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>mean<span class="op">$</span>covariance, <span class="dt">dig =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>[1] 77</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>sd<span class="op">$</span>covariance, <span class="dt">dig =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>[1] 97</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>mean<span class="op">$</span>rho, <span class="dt">dig =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>     [,1] [,2]
[1,] 1.00 0.18
[2,] 0.18 1.00</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>sd<span class="op">$</span>rho, <span class="dt">dig =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>     [,1] [,2]
[1,] 0.00 0.36
[2,] 0.36 0.00</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1"><span class="co"># Finally, we compare the prior and posterior distributions for the</span></a>
<a class="sourceLine" id="cb114-2" data-line-number="2"><span class="co"># (derived) ranef distribution parameters:</span></a>
<a class="sourceLine" id="cb114-3" data-line-number="3"></a>
<a class="sourceLine" id="cb114-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">3</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb114-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>mu_int_prior, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, </a>
<a class="sourceLine" id="cb114-6" data-line-number="6">    <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"mu_int_prior"</span>)</a>
<a class="sourceLine" id="cb114-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>mu_int_prior), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb114-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>mu_int, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">10</span>, </a>
<a class="sourceLine" id="cb114-9" data-line-number="9">    <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"mu_int"</span>)</a>
<a class="sourceLine" id="cb114-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>mu_int), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb114-11" data-line-number="11"></a>
<a class="sourceLine" id="cb114-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>mu_slope_prior, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, </a>
<a class="sourceLine" id="cb114-13" data-line-number="13">    <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"mu_slope_prior"</span>)</a>
<a class="sourceLine" id="cb114-14" data-line-number="14"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>mu_slope_prior), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb114-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>mu_slope, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">10</span>, </a>
<a class="sourceLine" id="cb114-16" data-line-number="16">    <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"mu_slope"</span>)</a>
<a class="sourceLine" id="cb114-17" data-line-number="17"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>mu_slope), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb114-18" data-line-number="18"></a>
<a class="sourceLine" id="cb114-19" data-line-number="19"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>sigma_int_prior, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, </a>
<a class="sourceLine" id="cb114-20" data-line-number="20">    <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"sigma_int_prior"</span>)</a>
<a class="sourceLine" id="cb114-21" data-line-number="21"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>sigma_int_prior), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb114-22" data-line-number="22"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>sigma_int, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">10</span>, </a>
<a class="sourceLine" id="cb114-23" data-line-number="23">    <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"sigma_int"</span>)</a>
<a class="sourceLine" id="cb114-24" data-line-number="24"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>sigma_int), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb114-25" data-line-number="25"></a>
<a class="sourceLine" id="cb114-26" data-line-number="26"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>sigma_slope_prior, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, </a>
<a class="sourceLine" id="cb114-27" data-line-number="27">    <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"sigma_slope_prior"</span>)</a>
<a class="sourceLine" id="cb114-28" data-line-number="28"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>sigma_slope_prior), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb114-29" data-line-number="29"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>sigma_slope, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">10</span>, </a>
<a class="sourceLine" id="cb114-30" data-line-number="30">    <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"sigma_slope"</span>)</a>
<a class="sourceLine" id="cb114-31" data-line-number="31"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>sigma_slope), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb114-32" data-line-number="32"></a>
<a class="sourceLine" id="cb114-33" data-line-number="33"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>rho_int_slope_prior, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, </a>
<a class="sourceLine" id="cb114-34" data-line-number="34">    <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"rho_int_slope_prior"</span>)</a>
<a class="sourceLine" id="cb114-35" data-line-number="35"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>rho_int_slope_prior), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb114-36" data-line-number="36"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>rho_int_slope, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, </a>
<a class="sourceLine" id="cb114-37" data-line-number="37">    <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"rho_int_slope"</span>)</a>
<a class="sourceLine" id="cb114-38" data-line-number="38"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(out<span class="op">$</span>sims.list<span class="op">$</span>rho_int_slope), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb114-39" data-line-number="39"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>))</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
</div>
</div>
<div id="finally-we-simulate-data-from-a-model-with-3-correlated-ranefs-and-then-provide-the-r-and-jags-analyses-of-this-data" class="section level2">
<h2 class="hasAnchor">
<a href="#finally-we-simulate-data-from-a-model-with-3-correlated-ranefs-and-then-provide-the-r-and-jags-analyses-of-this-data" class="anchor"></a>Finally, we simulate data from a model with 3 correlated ranefs and then provide the R and JAGS analyses of this data</h2>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1">n_subjects &lt;-<span class="st"> </span><span class="dv">56</span></a>
<a class="sourceLine" id="cb115-2" data-line-number="2">n_sample &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb115-3" data-line-number="3">n_obs &lt;-<span class="st"> </span>n_subjects <span class="op">*</span><span class="st"> </span>n_sample</a>
<a class="sourceLine" id="cb115-4" data-line-number="4">subjects &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/gl">gl</a></span>(<span class="dt">n =</span> n_subjects, <span class="dt">k =</span> n_sample)</a>
<a class="sourceLine" id="cb115-5" data-line-number="5"></a>
<a class="sourceLine" id="cb115-6" data-line-number="6"><span class="co"># Two standardized continuous covariates:</span></a>
<a class="sourceLine" id="cb115-7" data-line-number="7">original_x1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(n_obs, <span class="dv">45</span>, <span class="dv">70</span>)</a>
<a class="sourceLine" id="cb115-8" data-line-number="8">(mean_orig_x1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(original_x1))</a></code></pre></div>
<pre><code>[1] 57.27248</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1">(sd_orig_x1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/sd">sd</a></span>(original_x1))</a></code></pre></div>
<pre><code>[1] 7.195656</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1">x1 &lt;-<span class="st"> </span>(original_x1 <span class="op">-</span><span class="st"> </span>mean_orig_x1)<span class="op">/</span>sd_orig_x1</a>
<a class="sourceLine" id="cb119-2" data-line-number="2"></a>
<a class="sourceLine" id="cb119-3" data-line-number="3">original_x2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/GammaDist">rgamma</a></span>(n_obs, <span class="dv">10</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb119-4" data-line-number="4">(mean_orig_x2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(original_x2))</a></code></pre></div>
<pre><code>[1] 9.914929</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1">(sd_orig_x2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/sd">sd</a></span>(original_x2))</a></code></pre></div>
<pre><code>[1] 3.0587</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1">x2 &lt;-<span class="st"> </span>(original_x2 <span class="op">-</span><span class="st"> </span>mean_orig_x2)<span class="op">/</span>sd_orig_x2</a>
<a class="sourceLine" id="cb123-2" data-line-number="2"></a>
<a class="sourceLine" id="cb123-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb123-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(x1, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">15</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb123-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(x1), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb123-6" data-line-number="6"></a>
<a class="sourceLine" id="cb123-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(x2, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">15</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb123-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(x2), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb124-2" data-line-number="2"></a>
<a class="sourceLine" id="cb124-3" data-line-number="3"><span class="co"># Design matrix:</span></a>
<a class="sourceLine" id="cb124-4" data-line-number="4">Xmat &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/model.matrix">model.matrix</a></span>(<span class="op">~</span>subjects <span class="op">*</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>subjects <span class="op">*</span><span class="st"> </span>x2 <span class="op">-</span><span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x1 <span class="op">-</span><span class="st"> </span>x2)</a>
<a class="sourceLine" id="cb124-5" data-line-number="5"></a>
<a class="sourceLine" id="cb124-6" data-line-number="6"><span class="co"># Generate the correlated random effects for intercept and slope: Assembling</span></a>
<a class="sourceLine" id="cb124-7" data-line-number="7"><span class="co"># the parameters for the multivariate normal distribution</span></a>
<a class="sourceLine" id="cb124-8" data-line-number="8">intercept_mean &lt;-<span class="st"> </span><span class="dv">230</span></a>
<a class="sourceLine" id="cb124-9" data-line-number="9">intercept_sd &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb124-10" data-line-number="10">slope1_mean &lt;-<span class="st"> </span><span class="dv">60</span></a>
<a class="sourceLine" id="cb124-11" data-line-number="11">slope1_sd &lt;-<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb124-12" data-line-number="12">slope2_mean &lt;-<span class="st"> </span><span class="dv">40</span></a>
<a class="sourceLine" id="cb124-13" data-line-number="13">slope2_sd &lt;-<span class="st"> </span><span class="dv">25</span></a>
<a class="sourceLine" id="cb124-14" data-line-number="14">intercept_slope1_covariance &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb124-15" data-line-number="15">intercept_slope1_correlation &lt;-<span class="st"> </span>intercept_slope1_covariance<span class="op">/</span>(intercept_sd <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-16" data-line-number="16"><span class="st">    </span>slope1_sd)</a>
<a class="sourceLine" id="cb124-17" data-line-number="17">intercept_slope2_covariance &lt;-<span class="st"> </span><span class="dv">300</span></a>
<a class="sourceLine" id="cb124-18" data-line-number="18">intercept_slope2_correlation &lt;-<span class="st"> </span>intercept_slope2_covariance<span class="op">/</span>(intercept_sd <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-19" data-line-number="19"><span class="st">    </span>slope2_sd)</a>
<a class="sourceLine" id="cb124-20" data-line-number="20">slope1_slope2_covariance &lt;-<span class="st"> </span><span class="dv">-200</span></a>
<a class="sourceLine" id="cb124-21" data-line-number="21">slope1_slope2_correlation &lt;-<span class="st"> </span>slope1_slope2_covariance<span class="op">/</span>(slope1_sd <span class="op">*</span><span class="st"> </span>slope2_sd)</a>
<a class="sourceLine" id="cb124-22" data-line-number="22"></a>
<a class="sourceLine" id="cb124-23" data-line-number="23">mu_vector &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(intercept_mean, slope1_mean, slope2_mean)</a>
<a class="sourceLine" id="cb124-24" data-line-number="24">var_covar_matrix &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(intercept_sd<span class="op">^</span><span class="dv">2</span>, intercept_slope1_covariance, intercept_slope2_covariance, </a>
<a class="sourceLine" id="cb124-25" data-line-number="25">    intercept_slope1_covariance, slope1_sd<span class="op">^</span><span class="dv">2</span>, slope1_slope2_covariance, intercept_slope2_covariance, </a>
<a class="sourceLine" id="cb124-26" data-line-number="26">    slope1_slope2_covariance, slope2_sd<span class="op">^</span><span class="dv">2</span>), <span class="dv">3</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb124-27" data-line-number="27"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eigen">eigen</a></span>(var_covar_matrix)<span class="op">$</span>values</a></code></pre></div>
<pre><code>[1] 1039.4957  714.9788  170.5255</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="co"># Generating the correlated random effects for intercepts and slopes:</span></a>
<a class="sourceLine" id="cb126-2" data-line-number="2"></a>
<a class="sourceLine" id="cb126-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"MASS"</span>)</a>
<a class="sourceLine" id="cb126-4" data-line-number="4">effects &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/MASS/topics/mvrnorm">mvrnorm</a></span>(<span class="dt">n =</span> n_subjects, <span class="dt">mu =</span> mu_vector, <span class="dt">Sigma =</span> var_covar_matrix)</a>
<a class="sourceLine" id="cb126-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(effects)</a></code></pre></div>
<pre><code> num [1:56, 1:3] 238 204 261 247 224 ...
 - attr(*, "dimnames")=List of 2
  ..$ : NULL
  ..$ : NULL</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1"><span class="co"># round(effects, 2)</span></a>
<a class="sourceLine" id="cb128-2" data-line-number="2"></a>
<a class="sourceLine" id="cb128-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb128-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(effects[, <span class="dv">1</span>], <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb128-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(effects[, <span class="dv">1</span>]), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb128-6" data-line-number="6"></a>
<a class="sourceLine" id="cb128-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(effects[, <span class="dv">2</span>], <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb128-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(effects[, <span class="dv">2</span>]), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb128-9" data-line-number="9"></a>
<a class="sourceLine" id="cb128-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(effects[, <span class="dv">3</span>], <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">10</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb128-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(effects[, <span class="dv">3</span>]), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-12-2.png" width="700"></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb129-2" data-line-number="2"></a>
<a class="sourceLine" id="cb129-3" data-line-number="3"><span class="co"># Plotting the bivariate distributions:</span></a>
<a class="sourceLine" id="cb129-4" data-line-number="4">effects_kde12 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/MASS/topics/kde2d">kde2d</a></span>(effects[, <span class="dv">1</span>], effects[, <span class="dv">2</span>], <span class="dt">n =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb129-5" data-line-number="5">effects_kde13 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/MASS/topics/kde2d">kde2d</a></span>(effects[, <span class="dv">1</span>], effects[, <span class="dv">3</span>], <span class="dt">n =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb129-6" data-line-number="6">effects_kde23 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/MASS/topics/kde2d">kde2d</a></span>(effects[, <span class="dv">2</span>], effects[, <span class="dv">3</span>], <span class="dt">n =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb129-7" data-line-number="7"></a>
<a class="sourceLine" id="cb129-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">3</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb129-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/image">image</a></span>(effects_kde12)</a>
<a class="sourceLine" id="cb129-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/contour">contour</a></span>(effects_kde12, <span class="dt">add =</span> T)</a>
<a class="sourceLine" id="cb129-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/persp">persp</a></span>(effects_kde12, <span class="dt">phi =</span> <span class="dv">45</span>, <span class="dt">theta =</span> <span class="dv">-30</span>, <span class="dt">shade =</span> <span class="fl">0.1</span>, <span class="dt">border =</span> <span class="ot">NULL</span>, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, </a>
<a class="sourceLine" id="cb129-12" data-line-number="12">    <span class="dt">ticktype =</span> <span class="st">"detailed"</span>, <span class="dt">xlab =</span> <span class="st">""</span>, <span class="dt">ylab =</span> <span class="st">""</span>, <span class="dt">zlab =</span> <span class="st">""</span>)</a>
<a class="sourceLine" id="cb129-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/image">image</a></span>(effects_kde13)</a>
<a class="sourceLine" id="cb129-14" data-line-number="14"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/contour">contour</a></span>(effects_kde13, <span class="dt">add =</span> T)</a>
<a class="sourceLine" id="cb129-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/persp">persp</a></span>(effects_kde13, <span class="dt">phi =</span> <span class="dv">45</span>, <span class="dt">theta =</span> <span class="dv">-30</span>, <span class="dt">shade =</span> <span class="fl">0.1</span>, <span class="dt">border =</span> <span class="ot">NULL</span>, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, </a>
<a class="sourceLine" id="cb129-16" data-line-number="16">    <span class="dt">ticktype =</span> <span class="st">"detailed"</span>, <span class="dt">xlab =</span> <span class="st">""</span>, <span class="dt">ylab =</span> <span class="st">""</span>, <span class="dt">zlab =</span> <span class="st">""</span>)</a>
<a class="sourceLine" id="cb129-17" data-line-number="17"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/image">image</a></span>(effects_kde23)</a>
<a class="sourceLine" id="cb129-18" data-line-number="18"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/contour">contour</a></span>(effects_kde23, <span class="dt">add =</span> T)</a>
<a class="sourceLine" id="cb129-19" data-line-number="19"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/persp">persp</a></span>(effects_kde23, <span class="dt">phi =</span> <span class="dv">45</span>, <span class="dt">theta =</span> <span class="dv">-30</span>, <span class="dt">shade =</span> <span class="fl">0.1</span>, <span class="dt">border =</span> <span class="ot">NULL</span>, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, </a>
<a class="sourceLine" id="cb129-20" data-line-number="20">    <span class="dt">ticktype =</span> <span class="st">"detailed"</span>, <span class="dt">xlab =</span> <span class="st">""</span>, <span class="dt">ylab =</span> <span class="st">""</span>, <span class="dt">zlab =</span> <span class="st">""</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-12-3.png" width="700"></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb130-2" data-line-number="2"></a>
<a class="sourceLine" id="cb130-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(effects, <span class="dv">2</span>, mean)</a></code></pre></div>
<pre><code>[1] 232.57164  66.54891  38.56576</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(effects, <span class="dv">2</span>, sd)</a></code></pre></div>
<pre><code>[1] 19.57735 24.35077 26.89545</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(effects, <span class="dv">2</span>, var)</a></code></pre></div>
<pre><code>[1] 383.2725 592.9598 723.3653</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">cov</a></span>(effects[, <span class="dv">1</span>], effects[, <span class="dv">2</span>])</a></code></pre></div>
<pre><code>[1] 11.63389</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">cov</a></span>(effects[, <span class="dv">1</span>], effects[, <span class="dv">3</span>])</a></code></pre></div>
<pre><code>[1] 234.5988</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">cov</a></span>(effects[, <span class="dv">2</span>], effects[, <span class="dv">3</span>])</a></code></pre></div>
<pre><code>[1] -258.7406</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(effects)</a></code></pre></div>
<pre><code>          [,1]       [,2]      [,3]
[1,] 383.27247   11.63389  234.5988
[2,]  11.63389  592.95982 -258.7406
[3,] 234.59877 -258.74059  723.3653</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1">sigma_res &lt;-<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb144-2" data-line-number="2"></a>
<a class="sourceLine" id="cb144-3" data-line-number="3">population_parameters &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">intercept_mean =</span> intercept_mean, <span class="dt">slope1_mean =</span> slope1_mean, </a>
<a class="sourceLine" id="cb144-4" data-line-number="4">    <span class="dt">slope2_mean =</span> slope2_mean, <span class="dt">intercept_sd =</span> intercept_sd, <span class="dt">slope1_sd =</span> slope1_sd, </a>
<a class="sourceLine" id="cb144-5" data-line-number="5">    <span class="dt">slope2_sd =</span> slope2_sd, <span class="dt">intercept_slope1_covariance =</span> intercept_slope1_covariance, </a>
<a class="sourceLine" id="cb144-6" data-line-number="6">    <span class="dt">intercept_slope2_covariance =</span> intercept_slope2_covariance, <span class="dt">slope1_slope2_covariance =</span> slope1_slope2_covariance, </a>
<a class="sourceLine" id="cb144-7" data-line-number="7">    <span class="dt">sigma_res =</span> sigma_res)</a>
<a class="sourceLine" id="cb144-8" data-line-number="8"></a>
<a class="sourceLine" id="cb144-9" data-line-number="9">intercept_effects &lt;-<span class="st"> </span>effects[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb144-10" data-line-number="10"><span class="co"># round(intercept_effects, 2)</span></a>
<a class="sourceLine" id="cb144-11" data-line-number="11">slope1_effects &lt;-<span class="st"> </span>effects[, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb144-12" data-line-number="12"><span class="co"># round(slope1_effects, 2)</span></a>
<a class="sourceLine" id="cb144-13" data-line-number="13">slope2_effects &lt;-<span class="st"> </span>effects[, <span class="dv">3</span>]</a>
<a class="sourceLine" id="cb144-14" data-line-number="14"><span class="co"># round(slope2_effects, 2)</span></a>
<a class="sourceLine" id="cb144-15" data-line-number="15">all_effects &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(intercept_effects, slope1_effects, slope2_effects)</a>
<a class="sourceLine" id="cb144-16" data-line-number="16"></a>
<a class="sourceLine" id="cb144-17" data-line-number="17"><span class="co"># Generate the response variable: -- the deterministic part</span></a>
<a class="sourceLine" id="cb144-18" data-line-number="18">lin_pred &lt;-<span class="st"> </span>Xmat <span class="op">%*%</span><span class="st"> </span>all_effects</a>
<a class="sourceLine" id="cb144-19" data-line-number="19"><span class="co"># round(as.vector(lin_pred), 2)</span></a>
<a class="sourceLine" id="cb144-20" data-line-number="20"></a>
<a class="sourceLine" id="cb144-21" data-line-number="21"><span class="co"># -- the stochastic part</span></a>
<a class="sourceLine" id="cb144-22" data-line-number="22">sigma_res &lt;-<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb144-23" data-line-number="23">normal_error &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dt">n =</span> n_obs, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> sigma_res)  <span class="co"># residuals</span></a>
<a class="sourceLine" id="cb144-24" data-line-number="24"></a>
<a class="sourceLine" id="cb144-25" data-line-number="25"><span class="co"># -- add them together</span></a>
<a class="sourceLine" id="cb144-26" data-line-number="26">y &lt;-<span class="st"> </span>lin_pred <span class="op">+</span><span class="st"> </span>normal_error</a>
<a class="sourceLine" id="cb144-27" data-line-number="27"><span class="co"># or, in one go:</span></a>
<a class="sourceLine" id="cb144-28" data-line-number="28">y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dt">n =</span> n_obs, <span class="dt">mean =</span> lin_pred, <span class="dt">sd =</span> sigma_res)</a>
<a class="sourceLine" id="cb144-29" data-line-number="29"></a>
<a class="sourceLine" id="cb144-30" data-line-number="30"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(y, <span class="dt">col =</span> <span class="st">"lightsteelblue1"</span>, <span class="dt">border =</span> <span class="st">"white"</span>, <span class="dt">breaks =</span> <span class="dv">15</span>, <span class="dt">freq =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb144-31" data-line-number="31"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(y), <span class="dt">col =</span> <span class="st">"lightsteelblue3"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-12-4.png" width="700"></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"lattice"</span>)</a>
<a class="sourceLine" id="cb145-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/lattice/topics/xyplot">xyplot</a></span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">|</span><span class="st"> </span>subjects, <span class="dt">pch =</span> <span class="dv">20</span>)</a></code></pre></div>
<p><img src="count-regression-hierarchical-mixedeffects-vignette_files/figure-html/unnamed-chunk-12-5.png" width="700"></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1"><span class="co"># REML analysis using R</span></a>
<a class="sourceLine" id="cb146-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"lme4"</span>)</a>
<a class="sourceLine" id="cb146-3" data-line-number="3">lme_fit4 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/lme4/topics/lmer">lmer</a></span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">+</span><span class="st"> </span>(x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">|</span><span class="st"> </span>subjects))</a>
<a class="sourceLine" id="cb146-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(lme_fit4, <span class="dt">cor =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: y ~ x1 + x2 + (x1 + x2 | subjects)
REML criterion at convergence: 5699.067
Random effects:
 Groups   Name        Std.Dev. Corr       
 subjects (Intercept) 19.49               
          x1          23.18    -0.06      
          x2          26.53     0.52 -0.38
 Residual             31.18               
Number of obs: 560, groups:  subjects, 56
Fixed Effects:
(Intercept)           x1           x2  
     232.45        69.01        37.42  </code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1"><span class="co"># Compare with the true values:</span></a>
<a class="sourceLine" id="cb148-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">intercept_mean =</span> intercept_mean, <span class="dt">slope1_mean =</span> slope1_mean, <span class="dt">slope2_mean =</span> slope2_mean, </a>
<a class="sourceLine" id="cb148-3" data-line-number="3">    <span class="dt">intercept_sd =</span> intercept_sd, <span class="dt">slope1_sd =</span> slope1_sd, <span class="dt">slope2_sd =</span> slope2_sd, </a>
<a class="sourceLine" id="cb148-4" data-line-number="4">    <span class="dt">intercept_slope1_covariance =</span> intercept_slope1_covariance, <span class="dt">intercept_slope2_covariance =</span> intercept_slope2_covariance, </a>
<a class="sourceLine" id="cb148-5" data-line-number="5">    <span class="dt">slope1_slope2_covariance =</span> slope1_slope2_covariance, <span class="dt">sigma_res =</span> sigma_res)</a></code></pre></div>
<pre><code>  intercept_mean slope1_mean slope2_mean intercept_sd slope1_sd slope2_sd
1            230          60          40           20        30        25
  intercept_slope1_covariance intercept_slope2_covariance
1                          10                         300
  slope1_slope2_covariance sigma_res
1                     -200        30</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1"><span class="co"># Bayesian analysis using a scaled Inverse Wishart</span></a>
<a class="sourceLine" id="cb150-2" data-line-number="2"></a>
<a class="sourceLine" id="cb150-3" data-line-number="3"><span class="co"># Define model</span></a>
<a class="sourceLine" id="cb150-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"model {</span></a>
<a class="sourceLine" id="cb150-5" data-line-number="5"></a>
<a class="sourceLine" id="cb150-6" data-line-number="6"><span class="st"># Set up the means for the multivariate ranef distribution</span></a>
<a class="sourceLine" id="cb150-7" data-line-number="7"><span class="st">for (i in 1:3) {</span></a>
<a class="sourceLine" id="cb150-8" data-line-number="8"><span class="st">    xi[i]~dunif(0, 100)</span></a>
<a class="sourceLine" id="cb150-9" data-line-number="9"><span class="st">    mu_raw[i]~dnorm(0, .0001)</span></a>
<a class="sourceLine" id="cb150-10" data-line-number="10"><span class="st">    mu[i] &lt;- xi[i]*mu_raw[i]</span></a>
<a class="sourceLine" id="cb150-11" data-line-number="11"><span class="st">}</span></a>
<a class="sourceLine" id="cb150-12" data-line-number="12"><span class="st">mu_int &lt;- mu[1]</span></a>
<a class="sourceLine" id="cb150-13" data-line-number="13"><span class="st">mu_slope1 &lt;- mu[2]</span></a>
<a class="sourceLine" id="cb150-14" data-line-number="14"><span class="st">mu_slope2 &lt;- mu[3]</span></a>
<a class="sourceLine" id="cb150-15" data-line-number="15"></a>
<a class="sourceLine" id="cb150-16" data-line-number="16"><span class="st">Tau_B_raw[1:3, 1:3] ~ dwish(W[,], 4)</span></a>
<a class="sourceLine" id="cb150-17" data-line-number="17"><span class="st">Sigma_B_raw[1:3, 1:3] &lt;- inverse(Tau_B_raw[,])</span></a>
<a class="sourceLine" id="cb150-18" data-line-number="18"><span class="st">for (i in 1:3) {</span></a>
<a class="sourceLine" id="cb150-19" data-line-number="19"><span class="st">    sigma[i] &lt;- xi[i]*sqrt(Sigma_B_raw[i, i])</span></a>
<a class="sourceLine" id="cb150-20" data-line-number="20"><span class="st">}</span></a>
<a class="sourceLine" id="cb150-21" data-line-number="21"><span class="st">sigma_int &lt;- sigma[1]</span></a>
<a class="sourceLine" id="cb150-22" data-line-number="22"><span class="st">sigma_slope1 &lt;- sigma[2]</span></a>
<a class="sourceLine" id="cb150-23" data-line-number="23"><span class="st">sigma_slope2 &lt;- sigma[3]</span></a>
<a class="sourceLine" id="cb150-24" data-line-number="24"><span class="st">for (i in 1:3) { for (j in 1:3) {</span></a>
<a class="sourceLine" id="cb150-25" data-line-number="25"><span class="st">    rho[i, j] &lt;- Sigma_B_raw[i, j]/sqrt(Sigma_B_raw[i, i]*Sigma_B_raw[j, j])</span></a>
<a class="sourceLine" id="cb150-26" data-line-number="26"><span class="st">} }</span></a>
<a class="sourceLine" id="cb150-27" data-line-number="27"><span class="st">rho_int_slope1 &lt;- rho[1, 2]</span></a>
<a class="sourceLine" id="cb150-28" data-line-number="28"><span class="st">rho_int_slope2 &lt;- rho[1, 3]</span></a>
<a class="sourceLine" id="cb150-29" data-line-number="29"><span class="st">rho_slope1_slope2 &lt;- rho[2, 3]</span></a>
<a class="sourceLine" id="cb150-30" data-line-number="30"></a>
<a class="sourceLine" id="cb150-31" data-line-number="31"><span class="st">for (j in 1:n_subj) {</span></a>
<a class="sourceLine" id="cb150-32" data-line-number="32"><span class="ch">\t</span><span class="st">B_raw_hat[j, 1] &lt;- mu_raw[1]</span></a>
<a class="sourceLine" id="cb150-33" data-line-number="33"><span class="ch">\t</span><span class="st">B_raw_hat[j, 2] &lt;- mu_raw[2]</span></a>
<a class="sourceLine" id="cb150-34" data-line-number="34"><span class="ch">\t</span><span class="st">B_raw_hat[j, 3] &lt;- mu_raw[3]</span></a>
<a class="sourceLine" id="cb150-35" data-line-number="35"><span class="ch">\t</span><span class="st">B_raw[j, 1:3] ~ dmnorm(B_raw_hat[j, ], Tau_B_raw[, ])</span></a>
<a class="sourceLine" id="cb150-36" data-line-number="36"><span class="ch">\t</span><span class="st">alpha[j] &lt;- xi[1]*B_raw[j, 1]</span></a>
<a class="sourceLine" id="cb150-37" data-line-number="37"><span class="st">    beta1[j] &lt;- xi[2]*B_raw[j, 2]</span></a>
<a class="sourceLine" id="cb150-38" data-line-number="38"><span class="st">    beta2[j] &lt;- xi[3]*B_raw[j, 3]</span></a>
<a class="sourceLine" id="cb150-39" data-line-number="39"><span class="st">}</span></a>
<a class="sourceLine" id="cb150-40" data-line-number="40"></a>
<a class="sourceLine" id="cb150-41" data-line-number="41"><span class="st">sigma_res~dunif(0, 100) # Residual standard deviation</span></a>
<a class="sourceLine" id="cb150-42" data-line-number="42"><span class="st">tau_res &lt;- 1/(sigma_res*sigma_res)</span></a>
<a class="sourceLine" id="cb150-43" data-line-number="43"></a>
<a class="sourceLine" id="cb150-44" data-line-number="44"><span class="st">for (i in 1:n_obs) {</span></a>
<a class="sourceLine" id="cb150-45" data-line-number="45"><span class="st">    mu_obs[i] &lt;- alpha[subjects[i]]+beta1[subjects[i]]*x1[i]+beta2[subjects[i]]*x2[i]</span></a>
<a class="sourceLine" id="cb150-46" data-line-number="46"><span class="st">    y[i]~dnorm(mu_obs[i], tau_res)</span></a>
<a class="sourceLine" id="cb150-47" data-line-number="47"><span class="st">}</span></a>
<a class="sourceLine" id="cb150-48" data-line-number="48"></a>
<a class="sourceLine" id="cb150-49" data-line-number="49"><span class="st">for (i in 1:3) {</span></a>
<a class="sourceLine" id="cb150-50" data-line-number="50"><span class="st">    xi_prior[i]~dunif(0, 100)</span></a>
<a class="sourceLine" id="cb150-51" data-line-number="51"><span class="st">    mu_raw_prior[i]~dnorm(0, .0001)</span></a>
<a class="sourceLine" id="cb150-52" data-line-number="52"><span class="st">    mu_prior[i] &lt;- xi_prior[i]*mu_raw_prior[i]</span></a>
<a class="sourceLine" id="cb150-53" data-line-number="53"><span class="st">}</span></a>
<a class="sourceLine" id="cb150-54" data-line-number="54"><span class="st">mu_int_prior &lt;- mu_prior[1]</span></a>
<a class="sourceLine" id="cb150-55" data-line-number="55"><span class="st">mu_slope1_prior &lt;- mu_prior[2]</span></a>
<a class="sourceLine" id="cb150-56" data-line-number="56"><span class="st">mu_slope2_prior &lt;- mu_prior[3]</span></a>
<a class="sourceLine" id="cb150-57" data-line-number="57"><span class="st">Tau_B_raw_prior[1:3, 1:3] ~ dwish(W[,], 4)</span></a>
<a class="sourceLine" id="cb150-58" data-line-number="58"><span class="st">Sigma_B_raw_prior[1:3, 1:3] &lt;- inverse(Tau_B_raw_prior[,])</span></a>
<a class="sourceLine" id="cb150-59" data-line-number="59"><span class="st">for (i in 1:3) {</span></a>
<a class="sourceLine" id="cb150-60" data-line-number="60"><span class="st">    sigma_prior[i] &lt;- xi_prior[i]*sqrt(Sigma_B_raw_prior[i, i])</span></a>
<a class="sourceLine" id="cb150-61" data-line-number="61"><span class="st">}</span></a>
<a class="sourceLine" id="cb150-62" data-line-number="62"><span class="st">sigma_int_prior &lt;- sigma_prior[1]</span></a>
<a class="sourceLine" id="cb150-63" data-line-number="63"><span class="st">sigma_slope1_prior &lt;- sigma_prior[2]</span></a>
<a class="sourceLine" id="cb150-64" data-line-number="64"><span class="st">sigma_slope2_prior &lt;- sigma_prior[3]</span></a>
<a class="sourceLine" id="cb150-65" data-line-number="65"><span class="st">for (i in 1:3) { for (j in 1:3) {</span></a>
<a class="sourceLine" id="cb150-66" data-line-number="66"><span class="st">    rho_prior[i, j] &lt;- Sigma_B_raw_prior[i, j]/sqrt(Sigma_B_raw_prior[i, i]*Sigma_B_raw_prior[j, j])</span></a>
<a class="sourceLine" id="cb150-67" data-line-number="67"><span class="st">} }</span></a>
<a class="sourceLine" id="cb150-68" data-line-number="68"><span class="st">rho_int_slope1_prior &lt;- rho_prior[1, 2]</span></a>
<a class="sourceLine" id="cb150-69" data-line-number="69"><span class="st">rho_int_slope2_prior &lt;- rho_prior[1, 3]</span></a>
<a class="sourceLine" id="cb150-70" data-line-number="70"><span class="st">rho_slope1_slope2_prior &lt;- rho_prior[2, 3]</span></a>
<a class="sourceLine" id="cb150-71" data-line-number="71"><span class="st">}"</span>, </a>
<a class="sourceLine" id="cb150-72" data-line-number="72">    <span class="dt">fill =</span> <span class="ot">TRUE</span>, <span class="dt">file =</span> <span class="st">"lme_model5.txt"</span>)</a>
<a class="sourceLine" id="cb150-73" data-line-number="73"></a>
<a class="sourceLine" id="cb150-74" data-line-number="74"><span class="co"># Bundle data</span></a>
<a class="sourceLine" id="cb150-75" data-line-number="75">jags_data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">y =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(y), <span class="dt">subjects =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(subjects), <span class="dt">x1 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(x1), </a>
<a class="sourceLine" id="cb150-76" data-line-number="76">    <span class="dt">x2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(x2), <span class="dt">n_subj =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(subjects)), <span class="dt">n_obs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(n_obs), </a>
<a class="sourceLine" id="cb150-77" data-line-number="77">    <span class="dt">W =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diag">diag</a></span>(<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb150-78" data-line-number="78"></a>
<a class="sourceLine" id="cb150-79" data-line-number="79"><span class="co"># install.packages('bayesm')</span></a>
<a class="sourceLine" id="cb150-80" data-line-number="80"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"bayesm"</span>)</a>
<a class="sourceLine" id="cb150-81" data-line-number="81">var_vec &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(lme_fit4)<span class="op">$</span>subjects, <span class="dv">2</span>, var)</a>
<a class="sourceLine" id="cb150-82" data-line-number="82"></a>
<a class="sourceLine" id="cb150-83" data-line-number="83"><span class="co"># Inits function</span></a>
<a class="sourceLine" id="cb150-84" data-line-number="84">inits &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb150-85" data-line-number="85">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">xi =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">3</span>), <span class="dt">mu_raw =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">3</span>), <span class="dt">Tau_B_raw =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/bayesm/topics/rwishart">rwishart</a></span>(<span class="dv">4</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diag">diag</a></span>(<span class="dv">3</span>) <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb150-86" data-line-number="86"><span class="st">        </span>var_vec)<span class="op">$</span>W, <span class="dt">sigma_res =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">1</span>), <span class="dt">xi_prior =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Lognormal">rlnorm</a></span>(<span class="dv">3</span>), <span class="dt">mu_raw_prior =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">3</span>), </a>
<a class="sourceLine" id="cb150-87" data-line-number="87">        <span class="dt">Tau_B_raw_prior =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/bayesm/topics/rwishart">rwishart</a></span>(<span class="dv">4</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diag">diag</a></span>(<span class="dv">3</span>) <span class="op">*</span><span class="st"> </span>var_vec)<span class="op">$</span>W)</a>
<a class="sourceLine" id="cb150-88" data-line-number="88">}</a>
<a class="sourceLine" id="cb150-89" data-line-number="89"></a>
<a class="sourceLine" id="cb150-90" data-line-number="90"><span class="co"># Parameters to estimate</span></a>
<a class="sourceLine" id="cb150-91" data-line-number="91">params &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"mu"</span>, <span class="st">"mu_int"</span>, <span class="st">"mu_slope1"</span>, <span class="st">"mu_slope2"</span>, <span class="st">"sigma"</span>, <span class="st">"sigma_int"</span>, </a>
<a class="sourceLine" id="cb150-92" data-line-number="92">    <span class="st">"sigma_slope1"</span>, <span class="st">"sigma_slope2"</span>, <span class="st">"rho"</span>, <span class="st">"rho_int_slope1"</span>, <span class="st">"rho_int_slope2"</span>, </a>
<a class="sourceLine" id="cb150-93" data-line-number="93">    <span class="st">"rho_slope1_slope2"</span>, <span class="st">"alpha"</span>, <span class="st">"beta1"</span>, <span class="st">"beta2"</span>, <span class="st">"sigma_res"</span>, <span class="st">"mu_int_prior"</span>, </a>
<a class="sourceLine" id="cb150-94" data-line-number="94">    <span class="st">"mu_slope1_prior"</span>, <span class="st">"mu_slope2_prior"</span>, <span class="st">"sigma_int_prior"</span>, <span class="st">"sigma_slope1_prior"</span>, </a>
<a class="sourceLine" id="cb150-95" data-line-number="95">    <span class="st">"sigma_slope2_prior"</span>, <span class="st">"rho_prior"</span>, <span class="st">"rho_int_slope1_prior"</span>, <span class="st">"rho_int_slope2_prior"</span>, </a>
<a class="sourceLine" id="cb150-96" data-line-number="96">    <span class="st">"rho_slope1_slope2_prior"</span>)</a>
<a class="sourceLine" id="cb150-97" data-line-number="97"></a>
<a class="sourceLine" id="cb150-98" data-line-number="98"><span class="co"># MCMC settings</span></a>
<a class="sourceLine" id="cb150-99" data-line-number="99">ni &lt;-<span class="st"> </span><span class="dv">7000</span></a>
<a class="sourceLine" id="cb150-100" data-line-number="100">nb &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb150-101" data-line-number="101">nt &lt;-<span class="st"> </span><span class="dv">6</span></a>
<a class="sourceLine" id="cb150-102" data-line-number="102">nc &lt;-<span class="st"> </span><span class="dv">3</span>  <span class="co"># more than this probably needed for a good approx. of the posterior distribution</span></a>
<a class="sourceLine" id="cb150-103" data-line-number="103"></a>
<a class="sourceLine" id="cb150-104" data-line-number="104"><span class="co"># Start Gibbs sampler</span></a>
<a class="sourceLine" id="cb150-105" data-line-number="105"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"R2jags"</span>)</a>
<a class="sourceLine" id="cb150-106" data-line-number="106">outj &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/R2jags/topics/jags">jags</a></span>(jags_data, <span class="dt">inits =</span> inits, <span class="dt">parameters.to.save =</span> params, <span class="dt">model.file =</span> <span class="st">"lme_model5.txt"</span>, </a>
<a class="sourceLine" id="cb150-107" data-line-number="107">    <span class="dt">n.thin =</span> nt, <span class="dt">n.chains =</span> nc, <span class="dt">n.burnin =</span> nb, <span class="dt">n.iter =</span> ni)</a></code></pre></div>
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 560
   Unobserved stochastic nodes: 71
   Total graph size: 4494

Initializing model</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1"><span class="co"># traceplot(outj)</span></a>
<a class="sourceLine" id="cb152-2" data-line-number="2"></a>
<a class="sourceLine" id="cb152-3" data-line-number="3"><span class="co">## print(outj, dig = 3)</span></a>
<a class="sourceLine" id="cb152-4" data-line-number="4"></a>
<a class="sourceLine" id="cb152-5" data-line-number="5">out &lt;-<span class="st"> </span>outj<span class="op">$</span>BUGSoutput</a>
<a class="sourceLine" id="cb152-6" data-line-number="6"></a>
<a class="sourceLine" id="cb152-7" data-line-number="7"><span class="co"># Compare with MLEs and true values</span></a>
<a class="sourceLine" id="cb152-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>mean, <span class="dt">dig =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>$alpha
 [1] 226.2 205.6 260.1 261.6 221.1 213.5 230.1 253.0 218.5 235.6 230.9
[12] 257.9 225.6 267.3 235.6 241.7 218.5 241.2 247.7 245.0 242.7 225.9
[23] 203.1 225.8 249.1 236.3 217.3 231.4 225.7 207.0 207.7 213.3 240.8
[34] 267.7 235.3 248.3 221.8 246.1 228.6 226.1 213.9 257.9 201.7 236.6
[45] 235.0 236.9 239.3 225.8 218.5 219.6 248.4 213.9 229.3 250.2 224.8
[56] 230.2

$beta1
 [1]  45.86  68.89  80.59  25.20  40.62  73.84  84.37  64.00  53.84  59.23
[11]  77.50  49.69  68.01  40.98  96.80  96.85  55.93  64.82  69.46  78.71
[21]  44.11  66.92  53.30  82.41  87.70 101.19  52.55  78.52  33.48  51.33
[31]  89.41 111.05  40.62  94.52 108.40  71.94  53.50  73.35  93.78 103.09
[41]  87.96  42.31  64.96  66.16  57.98  59.09  67.82  43.71  55.68  96.64
[51]  73.22  80.76  69.76  59.89  59.82  95.56

$beta2
 [1]  54.025  16.278  60.722  75.391  37.029  20.143  44.278  69.809
 [9]  31.080  30.640  31.090  68.548  46.247  92.393  22.919  31.393
[17]  12.158  53.346  68.783  40.965 102.999  28.312  53.769   5.420
[25]  52.990  24.133  12.475  30.163  42.394  17.606   1.875  12.151
[33]  44.370  73.703   0.353  67.751  58.199  19.436  24.457  18.526
[41] -12.723  44.790  17.323  18.249  18.448  27.393  33.453  49.068
[49]  37.081  28.667  32.803  33.036  34.173  75.726  27.270  28.597

$deviance
[1] 5457

$mu
[1] 232.48  69.07  37.32

$mu_int
[1] 232.5

$mu_int_prior
[1] 81.79

$mu_slope1
[1] 69.07

$mu_slope1_prior
[1] 134.5

$mu_slope2
[1] 37.32

$mu_slope2_prior
[1] 163

$rho
         [,1]     [,2]    [,3]
[1,]  1.00000 -0.06369  0.5487
[2,] -0.06369  1.00000 -0.3836
[3,]  0.54869 -0.38361  1.0000

$rho_int_slope1
[1] -0.06369

$rho_int_slope1_prior
[1] 0.005588

$rho_int_slope2
[1] 0.5487

$rho_int_slope2_prior
[1] -0.001978

$rho_prior
          [,1]      [,2]      [,3]
[1,]  1.000000  0.005588 -0.001978
[2,]  0.005588  1.000000 -0.004068
[3,] -0.001978 -0.004068  1.000000

$rho_slope1_slope2
[1] -0.3836

$rho_slope1_slope2_prior
[1] -0.004068

$sigma
[1] 18.61 22.57 25.78

$sigma_int
[1] 18.61

$sigma_int_prior
[1] 65.91

$sigma_res
[1] 31.64

$sigma_slope1
[1] 22.57

$sigma_slope1_prior
[1] 65.07

$sigma_slope2
[1] 25.78

$sigma_slope2_prior
[1] 65.07</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">intercept_mean =</span> intercept_mean, <span class="dt">slope1_mean =</span> slope1_mean, <span class="dt">slope2_mean =</span> slope2_mean, </a>
<a class="sourceLine" id="cb154-2" data-line-number="2">    <span class="dt">intercept_sd =</span> intercept_sd, <span class="dt">slope1_sd =</span> slope1_sd, <span class="dt">slope2_sd =</span> slope2_sd, </a>
<a class="sourceLine" id="cb154-3" data-line-number="3">    <span class="dt">intercept_slope1_covariance =</span> intercept_slope1_covariance, <span class="dt">intercept_slope2_covariance =</span> intercept_slope2_covariance, </a>
<a class="sourceLine" id="cb154-4" data-line-number="4">    <span class="dt">slope1_slope2_covariance =</span> slope1_slope2_covariance, <span class="dt">sigma_res =</span> sigma_res)</a></code></pre></div>
<pre><code>  intercept_mean slope1_mean slope2_mean intercept_sd slope1_sd slope2_sd
1            230          60          40           20        30        25
  intercept_slope1_covariance intercept_slope2_covariance
1                          10                         300
  slope1_slope2_covariance sigma_res
1                     -200        30</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(lme_fit4, <span class="dt">cor =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: y ~ x1 + x2 + (x1 + x2 | subjects)
REML criterion at convergence: 5699.067
Random effects:
 Groups   Name        Std.Dev. Corr       
 subjects (Intercept) 19.49               
          x1          23.18    -0.06      
          x2          26.53     0.52 -0.38
 Residual             31.18               
Number of obs: 560, groups:  subjects, 56
Fixed Effects:
(Intercept)           x1           x2  
     232.45        69.01        37.42  </code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">intercept_mean =</span> intercept_mean, <span class="dt">slope1_mean =</span> slope1_mean, <span class="dt">slope2_mean =</span> slope2_mean, </a>
<a class="sourceLine" id="cb158-2" data-line-number="2">    <span class="dt">intercept_sd =</span> intercept_sd, <span class="dt">slope1_sd =</span> slope1_sd, <span class="dt">slope2_sd =</span> slope2_sd, </a>
<a class="sourceLine" id="cb158-3" data-line-number="3">    <span class="dt">intercept_slope1_covariance =</span> intercept_slope1_covariance, <span class="dt">intercept_slope2_covariance =</span> intercept_slope2_covariance, </a>
<a class="sourceLine" id="cb158-4" data-line-number="4">    <span class="dt">slope1_slope2_covariance =</span> slope1_slope2_covariance, <span class="dt">sigma_res =</span> sigma_res)</a></code></pre></div>
<pre><code>  intercept_mean slope1_mean slope2_mean intercept_sd slope1_sd slope2_sd
1            230          60          40           20        30        25
  intercept_slope1_covariance intercept_slope2_covariance
1                          10                         300
  slope1_slope2_covariance sigma_res
1                     -200        30</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1"><span class="co"># Note the large sd.s for the measures of association</span></a>
<a class="sourceLine" id="cb160-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>mean<span class="op">$</span>rho, <span class="dt">dig =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>       [,1]   [,2]  [,3]
[1,]  1.000 -0.064  0.55
[2,] -0.064  1.000 -0.38
[3,]  0.549 -0.384  1.00</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(out<span class="op">$</span>sd<span class="op">$</span>rho, <span class="dt">dig =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>     [,1] [,2] [,3]
[1,] 0.00 0.17 0.13
[2,] 0.17 0.00 0.14
[3,] 0.13 0.14 0.00</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1"><span class="co"># </span><span class="al">TBD</span><span class="co"> compare the prior and posterior distributions for the (derived) ranef</span></a>
<a class="sourceLine" id="cb164-2" data-line-number="2"><span class="co"># distribution parameters:</span></a></code></pre></div>
<p>s</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#linear-mixed-effects">Linear Mixed Effects</a><ul class="nav nav-pills nav-stacked">
<li><a href="#bayesian-hierarchical-analysis-using-jags">Bayesian hierarchical analysis using JAGS</a></li>
      <li><a href="#finally-we-simulate-data-from-a-model-with-3-correlated-ranefs-and-then-provide-the-r-and-jags-analyses-of-this-data">Finally, we simulate data from a model with 3 correlated ranefs and then provide the R and JAGS analyses of this data</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Bruce Campbell.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
